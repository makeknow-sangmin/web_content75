Ext.define("Sch.util.Patch",{target:null,minVersion:null,maxVersion:null,reportUrl:null,description:null,applyFn:null,ieOnly:!1,macOnly:!1,overrides:null,onClassExtended:function(a,b){Sch.disableOverrides||b.ieOnly&&!Ext.isIE||b.macOnly&&!Ext.isMac||b.minVersion&&!Ext.versions.extjs.equals(b.minVersion)&&!Ext.versions.extjs.isGreaterThan(b.minVersion)||b.maxVersion&&!Ext.versions.extjs.equals(b.maxVersion)&&!Ext.versions.extjs.isLessThan(b.maxVersion)||(b.applyFn?b.applyFn():Ext.ClassManager.get(b.target).override(b.overrides))}}),Ext.define("Sch.patches.Collection",{extend:"Sch.util.Patch",requires:["Ext.util.Collection"],target:"Ext.util.Collection",minVersion:"5.1.0",overrides:{updateKey:function(a,b){var g,c=this,d=c.map,e=c.indices,f=c.getSource();f&&!f.updating?f.updateKey(a,b):d[b]&&(g=c.getKey(a))!==b&&(b in d||d[g]!==a)&&(b in d&&delete d[b],c.updating++,c.generation++,d[g]=a,e&&(e[g]=e[b],delete e[b]),c.notify("updatekey",[{item:a,newKey:g,oldKey:b}]),c.updating--)}}}),Ext.define("Sch.patches.OperationDestroy",{extend:"Sch.util.Patch",requires:["Ext.data.operation.Destroy"],target:"Ext.data.operation.Destroy",minVersion:"5.1.1",maxVersion:"5.1.2",overrides:{doProcess:function(){var c,a=Ext.Array.slice(this.getRecords()),b=a.length;for(c=0;c<b;++c)a[c].setErased()}}}),Ext.define("Sch.patches.View",{extend:"Sch.util.Patch",requires:["Ext.view.View"],target:"Ext.view.View",minVersion:"5.1.0",overrides:{handleEvent:function(a){var b=this,c=b.keyEventRe.test(a.type),d=b.getNavigationModel();a.view=b,c&&(a.item=d.getItem(),a.record=d.getRecord()),a.item||(a.item=a.getTarget(b.itemSelector)),a.item&&!a.record&&(a.record=b.getRecord(a.item)),b.processUIEvent(a)!==!1&&b.processSpecialEvent(a),c&&!Ext.fly(a.target).isInputField()&&(a.getKey()===a.SPACE||a.isNavKeyPress(!0))&&a.preventDefault()}}}),Ext.define("Sch.locale.Locale",{l10n:null,legacyMode:!0,localeName:null,namespaceId:null,constructor:function(){Sch.locale.Active||(Sch.locale.Active={},this.bindRequire());var a=this.self.getName().split("."),b=this.localeName=a.pop();this.namespaceId=a.join(".");var c=Sch.locale.Active[this.namespaceId];"En"==b&&c&&"En"!=c.localeName||this.apply()},bindRequire:function(){var a=Ext.ClassManager.triggerCreated;Ext.ClassManager.triggerCreated=function(b){if(a.apply(this,arguments),b){var c=Ext.ClassManager.get(b);for(var d in Sch.locale.Active)Sch.locale.Active[d].apply(c)}}},applyToClass:function(a,b){var c=this,d=c.self.getName();if(b=b||Ext.ClassManager.get(a),b&&b.activeLocaleId!==d){var e=c.l10n[a];if("function"==typeof e?e(a):b.singleton?b.l10n=Ext.apply({},e,b.prototype&&b.prototype.l10n):Ext.override(b,{l10n:e}),c.legacyMode){var f;if(b.prototype?f=b.prototype:b.singleton&&(f=b),f&&f.legacyMode){f.legacyHolderProp&&(f[f.legacyHolderProp]||(f[f.legacyHolderProp]={}),f=f[f.legacyHolderProp]);for(var g in e)"function"!=typeof f[g]&&(f[g]=e[g])}}b.activeLocaleId=d,b.onLocalized&&b.onLocalized()}},apply:function(a){if(this.l10n){var b=this;if(a){Ext.isArray(a)||(a=[a]);for(var c,d,e=0,f=a.length;e<f;e++)Ext.isObject(a[e])?a[e].singleton?(d=a[e],c=Ext.getClassName(Ext.getClass(d))):(d=Ext.getClass(a[e]),c=Ext.getClassName(d)):(d=null,c="string"==typeof a[e]?a[e]:Ext.getClassName(a[e])),c&&c in this.l10n&&b.applyToClass(c,d)}else{Sch.locale.Active[this.namespaceId]=this;for(var g in this.l10n)b.applyToClass(g)}}}}),Ext.define("Sch.locale.En",{extend:"Sch.locale.Locale",singleton:!0,constructor:function(a){Ext.apply(this,{l10n:{"Sch.util.Date":{unitNames:{YEAR:{single:"year",plural:"years",abbrev:"yr"},QUARTER:{single:"quarter",plural:"quarters",abbrev:"q"},MONTH:{single:"month",plural:"months",abbrev:"mon"},WEEK:{single:"week",plural:"weeks",abbrev:"w"},DAY:{single:"day",plural:"days",abbrev:"d"},HOUR:{single:"hour",plural:"hours",abbrev:"h"},MINUTE:{single:"minute",plural:"minutes",abbrev:"min"},SECOND:{single:"second",plural:"seconds",abbrev:"s"},MILLI:{single:"ms",plural:"ms",abbrev:"ms"}}},"Sch.panel.TimelineGridPanel":{weekStartDay:1,loadingText:"Loading, please wait...",savingText:"Saving changes, please wait..."},"Sch.panel.TimelineTreePanel":{weekStartDay:1,loadingText:"Loading, please wait...",savingText:"Saving changes, please wait..."},"Sch.mixin.SchedulerView":{loadingText:"Loading events..."},"Sch.plugin.CurrentTimeLine":{tooltipText:"Current time"},"Sch.plugin.EventEditor":{saveText:"Save",deleteText:"Delete",cancelText:"Cancel"},"Sch.plugin.SimpleEditor":{newEventText:"New booking..."},"Sch.widget.ExportDialogForm":{formatFieldLabel:"Paper format",orientationFieldLabel:"Orientation",rangeFieldLabel:"Schedule range",showHeaderLabel:"Add page number",showFooterLabel:"Add footer",orientationPortraitText:"Portrait",orientationLandscapeText:"Landscape",completeViewText:"Complete schedule",currentViewText:"Visible schedule",dateRangeText:"Date range",dateRangeFromText:"Export from",dateRangeToText:"Export to",exportersFieldLabel:"Control pagination",adjustCols:"Adjust column width",adjustColsAndRows:"Adjust column width and row height",specifyDateRange:"Specify date range",columnPickerLabel:"Select columns",completeDataText:"Complete schedule (for all events)",dpiFieldLabel:"DPI (dots per inch)",rowsRangeLabel:"Rows range",allRowsLabel:"All rows",visibleRowsLabel:"Visible rows"},"Sch.widget.ExportDialog":{title:"Export Settings",exportButtonText:"Export",cancelButtonText:"Cancel",progressBarText:"Exporting..."},"Sch.plugin.Export":{generalError:"An error occurred",fetchingRows:"Fetching row {0} of {1}",builtPage:"Built page {0} of {1}",requestingPrintServer:"Please wait..."},"Sch.plugin.Printable":{dialogTitle:"Print settings",exportButtonText:"Print"},"Sch.plugin.exporter.AbstractExporter":{name:"Exporter"},"Sch.plugin.exporter.SinglePage":{name:"Single page"},"Sch.plugin.exporter.MultiPageVertical":{name:"Multiple pages (vertically)"},"Sch.plugin.exporter.MultiPage":{name:"Multiple pages"},"Sch.preset.Manager":{hourAndDay:{displayDateFormat:"G:i",middleDateFormat:"G:i",topDateFormat:"D d/m"},secondAndMinute:{displayDateFormat:"g:i:s",topDateFormat:"D, d g:iA"},dayAndWeek:{displayDateFormat:"m/d h:i A",middleDateFormat:"D d M"},weekAndDay:{displayDateFormat:"m/d",bottomDateFormat:"d M",middleDateFormat:"Y F d"},weekAndMonth:{displayDateFormat:"m/d/Y",middleDateFormat:"m/d",topDateFormat:"m/d/Y"},weekAndDayLetter:{displayDateFormat:"m/d/Y",middleDateFormat:"D d M Y"},weekDateAndMonth:{displayDateFormat:"m/d/Y",middleDateFormat:"d",topDateFormat:"Y F"},monthAndYear:{displayDateFormat:"m/d/Y",middleDateFormat:"M Y",topDateFormat:"Y"},year:{displayDateFormat:"m/d/Y",middleDateFormat:"Y"},manyYears:{displayDateFormat:"m/d/Y",middleDateFormat:"Y"}}}}),this.callParent(arguments)}}),Ext.define("Sch.mixin.Localizable",{requires:["Sch.locale.En"],legacyMode:!1,activeLocaleId:"",l10n:null,isLocaleApplied:function(){var a=this.singleton&&this.activeLocaleId||this.self.activeLocaleId;if(!a)return!1;for(var b in Sch.locale.Active)if(a===Sch.locale.Active[b].self.getName())return!0;return!1},applyLocale:function(){for(var a in Sch.locale.Active)Sch.locale.Active[a].apply(this.singleton?this:this.self.getName())},L:function(){return this.localize.apply(this,arguments)},localize:function(a,b,c){if(this.isLocaleApplied()||c||this.applyLocale(),this.hasOwnProperty("l10n")&&this.l10n.hasOwnProperty(a)&&"function"!=typeof this.l10n[a])return this.l10n[a];var d=this.self&&this.self.prototype;if(this.legacyMode){var e=b||this.legacyHolderProp,f=e?this[e]:this;if(f&&f.hasOwnProperty(a)&&"function"!=typeof f[a])return f[a];if(d){var g=e?d[e]:d;if(g&&g.hasOwnProperty(a)&&"function"!=typeof g[a])return g[a]}}var h=d.l10n&&d.l10n[a];if(null===h||void 0===h){var i=d&&d.superclass;if(i&&i.localize&&(h=i.localize(a,b,c)),null===h||void 0===h)throw"Cannot find locale: "+a+" ["+this.self.getName()+"]"}return h}}),Ext.define("Sch.util.Date",{requires:"Ext.Date",mixins:["Sch.mixin.Localizable"],singleton:!0,stripEscapeRe:/(\\.)/g,hourInfoRe:/([gGhHisucUOPZ]|MS)/,unitHash:null,unitsByName:{},constructor:function(){var a=Ext.Date,b=this.unitHash={MILLI:a.MILLI,SECOND:a.SECOND,MINUTE:a.MINUTE,HOUR:a.HOUR,DAY:a.DAY,WEEK:"w",MONTH:a.MONTH,QUARTER:"q",YEAR:a.YEAR};Ext.apply(this,b);var c=this;this.units=[c.MILLI,c.SECOND,c.MINUTE,c.HOUR,c.DAY,c.WEEK,c.MONTH,c.QUARTER,c.YEAR]},onLocalized:function(){this.setUnitNames(this.L("unitNames"))},setUnitNames:function(a){var b=this.unitsByName={};this.l10n.unitNames=a,this._unitNames=Ext.apply({},a);var c=this.unitHash;for(var d in c)if(c.hasOwnProperty(d)){var e=c[d];this._unitNames[e]=this._unitNames[d],b[d]=e,b[e]=e}},betweenLesser:function(a,b,c){var d=a.getTime();return b.getTime()<=d&&d<c.getTime()},constrain:function(a,b,c){return this.min(this.max(a,b),c)},compareUnits:function(a,b){var c=Ext.Array.indexOf(this.units,a),d=Ext.Array.indexOf(this.units,b);return c>d?1:c<d?-1:0},isUnitGreater:function(a,b){return this.compareUnits(a,b)>0},copyTimeValues:function(a,b){a.setHours(b.getHours()),a.setMinutes(b.getMinutes()),a.setSeconds(b.getSeconds()),a.setMilliseconds(b.getMilliseconds())},add:function(a,b,c){var d=Ext.Date.clone(a);if(!b||0===c)return d;switch(b.toLowerCase()){case this.MILLI:d=new Date(a.getTime()+c);break;case this.SECOND:d=new Date(a.getTime()+1e3*c);break;case this.MINUTE:d=new Date(a.getTime()+6e4*c);break;case this.HOUR:d=new Date(a.getTime()+36e5*c);break;case this.DAY:d.setDate(a.getDate()+c),23===d.getHours()&&0===a.getHours()&&(d=Ext.Date.add(d,Ext.Date.HOUR,1));break;case this.WEEK:d.setDate(a.getDate()+7*c);break;case this.MONTH:var e=a.getDate();e>28&&(e=Math.min(e,Ext.Date.getLastDateOfMonth(this.add(Ext.Date.getFirstDateOfMonth(a),this.MONTH,c)).getDate())),d.setDate(e),d.setMonth(d.getMonth()+c);break;case this.QUARTER:d=this.add(a,this.MONTH,3*c);break;case this.YEAR:d.setFullYear(a.getFullYear()+c)}return d},getUnitDurationInMs:function(a){return this.add(new Date(1,0,1),a,1)-new Date(1,0,1)},getMeasuringUnit:function(a){return a===this.WEEK?this.DAY:a},getDurationInUnit:function(a,b,c,d){var e;switch(c){case this.YEAR:e=this.getDurationInYears(a,b);break;case this.QUARTER:e=this.getDurationInMonths(a,b)/3;break;case this.MONTH:e=this.getDurationInMonths(a,b);break;case this.WEEK:e=this.getDurationInDays(a,b)/7;break;case this.DAY:e=this.getDurationInDays(a,b);break;case this.HOUR:e=this.getDurationInHours(a,b);break;case this.MINUTE:e=this.getDurationInMinutes(a,b);break;case this.SECOND:e=this.getDurationInSeconds(a,b);break;case this.MILLI:e=this.getDurationInMilliseconds(a,b)}return d?e:Math.round(e)},getUnitToBaseUnitRatio:function(a,b){if(a===b)return 1;switch(a){case this.YEAR:switch(b){case this.QUARTER:return.25;case this.MONTH:return 1/12}break;case this.QUARTER:switch(b){case this.YEAR:return 4;case this.MONTH:return 1/3}break;case this.MONTH:switch(b){case this.YEAR:return 12;case this.QUARTER:return 3}break;case this.WEEK:switch(b){case this.DAY:return 1/7;case this.HOUR:return 1/168}break;case this.DAY:switch(b){case this.WEEK:return 7;case this.HOUR:return 1/24;case this.MINUTE:return 1/1440}break;case this.HOUR:switch(b){case this.DAY:return 24;case this.MINUTE:return 1/60}break;case this.MINUTE:switch(b){case this.HOUR:return 60;case this.SECOND:return 1/60;case this.MILLI:return 1/6e4}break;case this.SECOND:switch(b){case this.MILLI:return.001}break;case this.MILLI:switch(b){case this.SECOND:return 1e3}}return-1},getDurationInMilliseconds:function(a,b){return b-a},getDurationInSeconds:function(a,b){return(b-a)/1e3},getDurationInMinutes:function(a,b){return(b-a)/6e4},getDurationInHours:function(a,b){return(b-a)/36e5},getDurationInDays:function(a,b){var c=a.getTimezoneOffset()-b.getTimezoneOffset();return(b-a+60*c*1e3)/864e5},getDurationInMonths:function(a,b){return 12*(b.getFullYear()-a.getFullYear())+(b.getMonth()-a.getMonth())},getDurationInYears:function(a,b){return this.getDurationInMonths(a,b)/12},min:function(a,b){return a<b?a:b},max:function(a,b){return a>b?a:b},intersectSpans:function(a,b,c,d){return this.betweenLesser(a,c,d)||this.betweenLesser(c,a,b)},getNameOfUnit:function(a){switch(a=this.getUnitByName(a),a.toLowerCase()){case this.YEAR:return"YEAR";case this.QUARTER:return"QUARTER";case this.MONTH:return"MONTH";case this.WEEK:return"WEEK";case this.DAY:return"DAY";case this.HOUR:return"HOUR";case this.MINUTE:return"MINUTE";case this.SECOND:return"SECOND";case this.MILLI:return"MILLI"}throw"Incorrect UnitName"},getReadableNameOfUnit:function(a,b){return this.isLocaleApplied()||this.applyLocale(),this._unitNames[a][b?"plural":"single"]},getShortNameOfUnit:function(a){return this.isLocaleApplied()||this.applyLocale(),this._unitNames[a].abbrev},getUnitByName:function(a){return this.isLocaleApplied()||this.applyLocale(),this.unitsByName[a]||Ext.Error.raise("Unknown unit name: "+a),this.unitsByName[a]},getNext:function(a,b,c,d){var e=Ext.Date.clone(a);switch(d=arguments.length<4?1:d,c=null==c?1:c,b){case this.MILLI:e=this.add(a,b,c);break;case this.SECOND:e=this.add(a,b,c),e.getMilliseconds()>0&&e.setMilliseconds(0);break;case this.MINUTE:e=this.add(a,b,c),e.getSeconds()>0&&e.setSeconds(0),e.getMilliseconds()>0&&e.setMilliseconds(0);break;case this.HOUR:e=this.add(a,b,c),e.getMinutes()>0&&e.setMinutes(0),e.getSeconds()>0&&e.setSeconds(0),e.getMilliseconds()>0&&e.setMilliseconds(0);break;case this.DAY:var f=23===a.getHours()&&1===this.add(e,this.HOUR,1).getHours();if(f)return e=this.add(e,this.DAY,2),this.clearTime(e),e;this.clearTime(e),e=this.add(e,this.DAY,c),1===e.getHours()&&this.clearTime(e);break;case this.WEEK:this.clearTime(e);var g=e.getDay();e=this.add(e,this.DAY,d-g+7*(c-(d<=g?0:1))),e.getDay()!==d?e=this.add(e,this.HOUR,1):this.clearTime(e);break;case this.MONTH:e=this.add(e,this.MONTH,c),e.setDate(1),this.clearTime(e);break;case this.QUARTER:e=this.add(e,this.MONTH,3*(c-1)+(3-e.getMonth()%3)),this.clearTime(e),e.setDate(1);break;case this.YEAR:e=new Date(e.getFullYear()+c,0,1);break;default:throw"Invalid date unit"}return e},getNumberOfMsFromTheStartOfDay:function(a){return a-this.clearTime(a,!0)||864e5},getNumberOfMsTillTheEndOfDay:function(a){return this.getStartOfNextDay(a,!0)-a},getStartOfNextDay:function(a,b,c){var d=this.add(c?a:this.clearTime(a,b),this.DAY,1);if(d.getDate()==a.getDate()){var e=this.add(this.clearTime(a,b),this.DAY,2).getTimezoneOffset(),f=a.getTimezoneOffset();d=this.add(d,this.MINUTE,f-e)}return d},getEndOfPreviousDay:function(a,b){var c=b?a:this.clearTime(a,!0);return c-a?c:this.add(c,this.DAY,-1)},timeSpanContains:function(a,b,c,d){return c-a>=0&&b-d>=0},compareWithPrecision:function(a,b,c){var f,d=Sch.util.Date,e=Ext.Date;switch(c){case d.DAY:a=Number(e.format(a,"Ymd")),b=Number(e.format(b,"Ymd"));break;case d.WEEK:a=Number(e.format(a,"YmW")),b=Number(e.format(b,"YmW"));break;case d.MONTH:a=Number(e.format(a,"Ym")),b=Number(e.format(b,"Ym"));break;case d.QUARTER:a=4*a.getFullYear()+Math.floor(a.getMonth()/3),b=4*b.getFullYear()+Math.floor(b.getMonth()/3);break;case d.YEAR:a=a.getFullYear(),b=b.getFullYear();break;default:case d.MILLI:case d.SECOND:case d.MINUTE:case d.HOUR:c=c&&this.getUnitDurationInMs(c)||1,a=Math.floor(a.valueOf()/c),b=Math.floor(b.valueOf()/c)}return a<b&&(f=-1)||a>b&&(f=1)||(f=0),f},getValueInUnits:function(a,b){switch(b){case this.MONTH:return a.getMonth();case this.DAY:return a.getDate();case this.HOUR:return a.getHours();case this.MINUTE:return a.getMinutes();case this.SECOND:return a.getSeconds()}},setValueInUnits:function(a,b,c){var e,d=Ext.Date.clone(a);switch(b){case this.YEAR:e="setFullYear";break;case this.MONTH:e="setMonth";break;case this.DAY:e="setDate";break;case this.HOUR:e="setHours";break;case this.MINUTE:e="setMinutes";break;case this.SECOND:e="setSeconds";break;case this.MILLI:e="setMilliseconds"}return d[e](c),d},getSubUnit:function(a){switch(a){case this.YEAR:return this.MONTH;case this.MONTH:return this.DAY;case this.DAY:return this.HOUR;case this.HOUR:return this.MINUTE;case this.MINUTE:return this.SECOND;case this.SECOND:return this.MILLI}},setValueInSubUnits:function(a,b,c){return b=this.getSubUnit(b),this.setValueInUnits(a,b,c)},mergeDates:function(a,b,c){var d=Ext.Date.clone(a);switch(c){case this.YEAR:d.setFullYear(b.getFullYear());case this.MONTH:d.setMonth(b.getMonth());case this.WEEK:case this.DAY:c===this.WEEK?d=this.add(d,this.DAY,b.getDay()-d.getDay()):d.setDate(b.getDate());case this.HOUR:d.setHours(b.getHours());case this.MINUTE:d.setMinutes(b.getMinutes());case this.SECOND:d.setSeconds(b.getSeconds());case this.MILLI:d.setMilliseconds(b.getMilliseconds())}return d},splitToSubUnits:function(a,b,c,d){switch(c=c||1,d=arguments.length<4?1:d,b){case this.MONTH:return this.splitMonth(a,c,d);case this.WEEK:case this.DAY:return this.splitDay(a,c)}},splitYear:function(a,b){var c=this.clearTime(a,!0);c.setMonth(0),c.setDate(1);for(var d=[],e=0;e<=12;e+=b)d.push(this.add(c,this.MONTH,e));return d},splitMonth:function(a,b,c){var d=this.clearTime(a,!0);d.setDate(1),d=this.add(d,this.DAY,c-d.getDay());for(var e=Ext.Date.clone(d),f=this.add(d,this.MONTH,1),g=[],h=0;e.getTime()<f.getTime();h+=b)e=this.add(d,this.WEEK,h),g.push(e);return g},splitWeek:function(a,b,c){var d=this.add(a,this.DAY,c-a.getDay());d=this.clearTime(d);for(var e=[],f=0;f<=7;f+=b)e.push(this.add(d,this.DAY,f));return e},splitDay:function(a,b){for(var c=this.clearTime(a,!0),d=[],e=0;e<=24;e+=b)d.push(this.add(c,this.HOUR,e));return d},splitHour:function(a,b){var c=new Date(a.getTime());c.setMinutes(0),c.setSeconds(0),c.setMilliseconds(0);for(var d=[],e=0;e<=60;e+=b)d.push(this.add(c,this.MINUTE,e));return d},splitMinute:function(a,b){var c=Ext.Date.clone(a);c.setSeconds(0),c.setMilliseconds(0);for(var d=[],e=0;e<=60;e+=b)d.push(this.add(c,this.SECOND,e));return d},clearTime:function(a,b){return a.getHours()>0||a.getMinutes()>0||a.getSeconds()>0?Ext.Date.clearTime(a,b):b?Ext.Date.clone(a):a}}),Ext.define("Sch.util.Cache",{cache:null,constructor:function(){this.cache={}},key:function(a){var b;return b=a instanceof Ext.data.Model?a.getId().toString():void 0===a||null===a?"[ undefined / null ]":a.toString()},get:function(a,b){var d,c=this;return a=c.key(a),d=c.cache.hasOwnProperty(a)&&c.cache[a],!d&&b?d=b():d||(d=[]),c.cache[a]=d,d},add:function(a,b){var c=this,d=c.key(a);return c.cache.hasOwnProperty(d)||(c.cache[d]=c.get(a)),Ext.Array.include(c.cache[d],b),c},remove:function(a,b){var c=this;return a=c.key(a),c.cache.hasOwnProperty(a)&&Ext.Array.remove(c.cache[a],b),c},move:function(a,b,c){var d=this;a=d.key(a),b=d.key(b),a!=b&&arguments.length>=3?(d.remove(a,c),d.add(b,c)):a!=b&&d.cache.hasOwnProperty(a)&&d.cache.hasOwnProperty(b)?(d.cache[b]=Ext.Array.union(d.cache[b],d.cache[a]),d.cache[a]=[]):a!=b&&d.cache.hasOwnProperty(a)&&(d.cache[b]=d.cache[a],d.cache[a]=[])},clear:function(a){var b=this;return arguments.length?(a=b.key(a),b.cache.hasOwnProperty(a)&&delete b.cache[a]):b.cache={},b},uncache:function(a){var c,b=this;for(c in b.cache)b.cache.hasOwnProperty(c)&&(b.cache[c]=Ext.Array.remove(b.cache[c],a));return b}}),Ext.ClassManager.get("Sch.model.Customizable")||Ext.define("Sch.model.Customizable",{extend:"Ext.data.Model",customizableFields:null,previous:null,__editing:null,__editCounter:0,constructor:function(){var a=this.callParent(arguments);return a},onClassExtended:function(a,b,c){var d=c.onBeforeCreated;c.onBeforeCreated=function(a,b){d.apply(this,arguments);var c=a.prototype;if(c.customizableFields){c.customizableFields=(a.superclass.customizableFields||[]).concat(c.customizableFields);var e=c.customizableFields,f={},g=this,h=Ext.Array.findBy(a.fields,function(a){return a.name===c.idProperty});g.idField=c.idField=h,a.fieldsMap[c.idProperty]||(a.fieldsMap[c.idProperty]=h),Ext.Array.forEach(e,function(a){"string"==typeof a&&(a={name:a}),f[a.name]=a});var i=c.fields,j=[],k=[];Ext.Array.forEach(i,function(a){a.isCustomizableField&&k.push(a.getName())}),"id"!==c.idProperty&&c.getField("id")&&(c.getField("id").hasOwnProperty("name")||k.push("id")),"Id"!==c.idProperty&&c.getField("Id")&&(c.getField("Id").hasOwnProperty("name")||k.push("Id")),a.removeFields(k),Ext.Object.each(f,function(a,b){b.isCustomizableField=!0;var i,d=b.name||b.getName(),f="Id"===d?"idProperty":d.charAt(0).toLowerCase()+d.substr(1)+"Field",g=c[f],h=g||d;c.getField(h)?(i=Ext.applyIf({name:d,isCustomizableField:!0},c.getField(h)),c.getField(h).isCustomizableField=!0,i=Ext.create("data.field."+(i.type||"auto"),i),e.push(i)):(i=Ext.applyIf({name:h,isCustomizableField:!0},b),i=Ext.create("data.field."+(i.type||"auto"),i),j.push(i));var k=Ext.String.capitalize(d);if("Id"!=k){var l="get"+k,m="set"+k;(!c[l]||c[l].__getterFor__&&c[l].__getterFor__!=h)&&(c[l]=function(){return this.get(this[f]||h)},c[l].__getterFor__=h),(!c[m]||c[m].__setterFor__&&c[m].__setterFor__!=h)&&(c[m]=function(a){return this.set(this[f]||h,a)},c[m].__setterFor__=h)}}),a.addFields(j)}}},set:function(a,b){var c,d;if(this.previous=this.previous||{},"string"==typeof a){if(c=this.get(a),c instanceof Date&&!(b instanceof Date)&&(b=this.getField(a).convert(b,this)),!(c instanceof Date&&c-b)&&(c instanceof Date||c===b))return[];this.previous[a]=c}else for(var e in a){c=this.get(e);var f=a[e];c instanceof Date&&!(f instanceof Date)&&(f=this.getField(e).convert(f,this)),(c instanceof Date&&c-f||!(c instanceof Date)&&c!==f)&&(this.previous[e]=c)}return d=this.callParent(arguments),this.__editing||delete this.previous,d},reject:function(){var c,a=this,b=a.modified||{};a.__editing=!0,a.previous=a.previous||{};for(c in b)b.hasOwnProperty(c)&&"function"!=typeof b[c]&&(a.previous[c]=a.get(c));a.callParent(arguments),delete a.previous,a.__editing=!1},beginEdit:function(){this.__editCounter++,this.__editing=!0,this.callParent(arguments)},cancelEdit:function(){this.__editCounter=0,this.__editing=!1,this.callParent(arguments),delete this.previous},endEdit:function(a,b){if(0===--this.__editCounter){if(!a&&this.getModifiedFieldNames){var c=this.editMemento;b||(b=this.getModifiedFieldNames(c.data)),b&&0===b.length&&(a=!0)}this.callParent([a].concat(Array.prototype.slice.call(arguments,1))),this.__editing=!1,delete this.previous}}}),Ext.ClassManager.get("Sch.model.Range")||Ext.define("Sch.model.Range",{extend:"Sch.model.Customizable",requires:["Sch.util.Date"],idProperty:"Id",config:Ext.versions.touch?{idProperty:"Id"}:null,startDateField:"StartDate",endDateField:"EndDate",nameField:"Name",clsField:"Cls",customizableFields:[{name:"StartDate",type:"date",dateFormat:"c"},{name:"EndDate",type:"date",dateFormat:"c"},{name:"Cls",type:"string"},{name:"Name",type:"string"}],setStartDate:function(a,b){var c=this.getEndDate(),d=this.getStartDate();this.set(this.startDateField,a),b===!0&&c&&d&&this.setEndDate(Sch.util.Date.add(a,Sch.util.Date.MILLI,c-d))},setEndDate:function(a,b){var c=this.getStartDate(),d=this.getEndDate();this.set(this.endDateField,a),b===!0&&c&&d&&this.setStartDate(Sch.util.Date.add(a,Sch.util.Date.MILLI,-(d-c)))},setStartEndDate:function(a,b){this.beginEdit(),this.set(this.startDateField,a),this.set(this.endDateField,b),this.endEdit()},getDates:function(){for(var a=[],b=this.getEndDate(),c=Ext.Date.clearTime(this.getStartDate(),!0);c<b;c=Sch.util.Date.add(c,Sch.util.Date.DAY,1))a.push(c);return a},forEachDate:function(a,b){return Ext.each(this.getDates(),a,b)},isValid:function(){var a=this.callParent(arguments);if(a){var b=this.getStartDate(),c=this.getEndDate();a=!b||!c||c-b>=0}return a},shift:function(a,b){this.setStartEndDate(Sch.util.Date.add(this.getStartDate(),a,b),Sch.util.Date.add(this.getEndDate(),a,b))},fullCopy:function(){return this.copy.apply(this,arguments)}}),Ext.ClassManager.get("Sch.model.Resource")||Ext.define("Sch.model.Resource",{extend:"Sch.model.Customizable",idProperty:"Id",config:Ext.versions.touch?{idProperty:"Id"}:null,nameField:"Name",customizableFields:[{name:"Name",type:"string"}],getInternalId:function(){return this.internalId},getResourceStore:function(){return this.joined&&this.joined[0]},getEventStore:function(){var a=this.getResourceStore();return a&&a.getEventStore()||this.parentNode&&this.parentNode.getEventStore()},getAssignmentStore:function(){var a=this.getEventStore();return a&&a.getAssignmentStore()},getEvents:function(a){var b=this;return a=a||b.getEventStore(),a&&a.getEventsForResource(b)||[]},getAssignments:function(){var a=this,b=a.getEventStore();return b&&b.getAssignmentsForResource(a)},isPersistable:function(){var a=this.parentNode;return!a||!a.phantom||a.isRoot&&a.isRoot()}}),Ext.ClassManager.get("Sch.model.Event")||Ext.define("Sch.model.Event",{extend:"Sch.model.Range",idProperty:"Id",customizableFields:[{name:"ResourceId"},{name:"Draggable",type:"boolean",persist:!1,defaultValue:!0},{name:"Resizable",persist:!1,defaultValue:!0}],resourceIdField:"ResourceId",draggableField:"Draggable",resizableField:"Resizable",getInternalId:function(){return this.internalId},getEventStore:function(){var a=this,b=a.joined&&a.joined[0];return b&&!b.isEventStore&&(Ext.Array.sort(a.joined,function(a,b){return(a.isEventStore||!1)>(b.isEventStore||!1)&&-1||1}),b=a.joined[0],b=b.isEventStore?b:null),b},getResourceStore:function(){var a=this.getEventStore();return a&&a.getResourceStore()},getAssignmentStore:function(){var a=this.getEventStore();return a&&a.getAssignmentStore()},getResources:function(){var a=this,b=a.getEventStore();return b&&b.getResourcesForEvent(a)||[]},forEachResource:function(a,b){for(var c=this.getResources(),d=0;d<c.length;d++)if(a.call(b||this,c[d])===!1)return},getResource:function(a,b){var e,c=this,d=null;return b=b||c.getEventStore(),e=b&&b.getResourceStore(),a=null==a?c.getResourceId():a,!b||null!==a&&void 0!==a?e&&(d=e.getModelById(a)):(d=b.getResourcesForEvent(c),1==d.length?d=d[0]:d.length>1?Ext.Error.raise("Event::getResource() is not applicable for events with multiple assignments, please use Event::getResources() instead."):d=null),d},setResource:function(a){var b=this,c=b.getEventStore();c&&c.removeAssignmentsForEvent(b),b.assign(a)},assign:function(a){var b=this,c=b.getEventStore();a=a instanceof Sch.model.Resource?a.getId():a,c?c.assignEventToResource(b,a):b.setResourceId(a)},unassign:function(a){var b=this,c=b.getEventStore();a=a instanceof Sch.model.Resource?a.getId():a,c?c.unassignEventFromResource(b,a):b.getResourceId()==a&&b.setResourceId(null)},reassign:function(a,b){var c=this,d=c.getEventStore();a=a instanceof Sch.model.Resource?a.getId():a,b=b instanceof Sch.model.Resource?b.getId():b,d?d.reassignEventFromResourceToResource(c,a,b):c.setResourceId(b)},isAssignedTo:function(a){var b=this,c=b.getEventStore(),d=!1;return a=a instanceof Sch.model.Resource&&a.getId()||a,d=c?c.isEventAssignedToResource(b,a):b.getResourceId()==a},getAssignments:function(){var a=this,b=a.getEventStore();return b&&b.getAssignmentsForEvent(a)},isDraggable:function(){return this.getDraggable()},isResizable:function(){return this.getResizable()},isPersistable:function(){var a=this,b=a.getEventStore();return b&&b.isEventPersistable(a)}}),Ext.ClassManager.get("Sch.data.util.IdConsistencyManager")||Ext.define("Sch.data.util.IdConsistencyManager",{config:{eventStore:null,resourceStore:null,assignmentStore:null},eventStoreDetacher:null,resourceStoreDetacher:null,constructor:function(a){this.initConfig(a)},updateEventStore:function(a,b){var c=this;Ext.destroyMembers(c,"eventStoreDetacher"),a&&(c.eventStoreDetacher=a.on({idchanged:c.onEventIdChanged,scope:c,destroyable:!0,priority:200}))},updateResourceStore:function(a,b){var c=this;Ext.destroyMembers(c,"resourceStoreDetacher"),a&&(c.resourceStoreDetacher=a.on({idchanged:c.onResourceIdChanged,scope:c,destroyable:!0,priority:200}))},onEventIdChanged:function(a,b,c,d){var g,e=this,f=e.getAssignmentStore();f&&(g=e.getUpdateAssignmentEventIdFieldFn(f,c,d),a.on("update",g,null,{single:!0,priority:200}))},onResourceIdChanged:function(a,b,c,d){var h,i,e=this,f=e.getEventStore(),g=e.getAssignmentStore();f&&!g&&(h=e.getUpdateEventResourceIdFieldFn(f,c,d)),g&&(i=e.getUpdateAssignmentResourceIdFieldFn(g,c,d)),(h||g)&&a.on("update",function(){h&&h(),i&&i()},null,{single:!0,priority:200})},getUpdateEventResourceIdFieldFn:function(a,b,c){var d=a.getRange();return function(){Ext.Array.forEach(d,function(a){a.getResourceId()==b&&a.setResourceId(c)})}},getUpdateAssignmentEventIdFieldFn:function(a,b,c){var d=a.getAssignmentsForEvent(b);return function(){Ext.Array.forEach(d,function(a){a.getEventId()==b&&a.setEventId(c)})}},getUpdateAssignmentResourceIdFieldFn:function(a,b,c){var d=a.getAssignmentsForResource(b);return function(){Ext.Array.forEach(d,function(a){a.getResourceId()==b&&a.setResourceId(c)})}}}),Ext.ClassManager.get("Sch.data.util.ModelPersistencyManager")||Ext.define("Sch.data.util.ModelPersistencyManager",{config:{eventStore:null,resourceStore:null,assignmentStore:null},eventStoreDetacher:null,resourceStoreDetacher:null,assignmentStoreDetacher:null,constructor:function(a){this.initConfig(a)},updateEventStore:function(a,b){var c=this;Ext.destroyMembers(c,"eventStoreDetacher"),a&&a.autoSync&&(c.eventStoreDetacher=a.on({beforesync:c.onEventStoreBeforeSync,scope:c,destroyable:!0,priority:100}))},updateResourceStore:function(a,b){var c=this;Ext.destroyMembers(c,"resourceStoreDetacher"),a&&a.autoSync&&(c.resourceStoreDetacher=a.on({beforesync:c.onResourceStoreBeforeSync,scope:c,destroyable:!0,priority:100}))},updateAssignmentStore:function(a,b){var c=this;Ext.destroyMembers(c,"assignmentStoreDetacher"),a&&a.autoSync&&(c.assignmentStoreDetacher=a.on({beforesync:c.onAssignmentStoreBeforeSync,scope:c,destroyable:!0,priority:100}))},onEventStoreBeforeSync:function(a){var b=this;return b.removeNonPersistableRecordsToCreate(a),b.shallContinueSync(a)},onResourceStoreBeforeSync:function(a){var b=this;return b.removeNonPersistableRecordsToCreate(a),b.shallContinueSync(a)},onAssignmentStoreBeforeSync:function(a){var b=this;return b.removeNonPersistableRecordsToCreate(a),b.shallContinueSync(a)},removeNonPersistableRecordsToCreate:function(a){var c,d,b=a.create||[];for(d=b.length-1;d>=0;--d)c=b[d],c.isPersistable()||Ext.Array.remove(b,c);0===b.length&&delete a.create},shallContinueSync:function(a){return Boolean(a.create&&a.create.length>0||a.update&&a.update.length>0||a.destroy&&a.destroy.length>0)}}),Ext.define("Sch.data.util.ResourceEventsCache",{extend:"Sch.util.Cache",requires:["Ext.data.Model"],eventStore:null,eventStoreDetacher:null,resourceStoreDetacher:null,constructor:function(a){function d(a,c){Ext.Array.forEach(c,function(a){b.add(a.getResourceId(),a)})}function e(a,c){Ext.Array.forEach(c,function(a){b.remove(a.getResourceId(),a)})}function f(a,c,d,e){var f=c.resourceIdField,g=c.previous&&f in c.previous,h=g&&c.previous[f];g&&b.move(h,c.getResourceId(),c)}function g(){b.clear()}function h(a,c,d){b.clear(),l(c)}function i(a,c,d,e){b.move(d,e)}function j(a,c){Ext.Array.forEach(c,function(a){b.clear(a)})}function k(){b.clear()}function l(a){Ext.destroy(b.resourceStoreDetacher),b.resourceStoreDetacher=a&&a.on({idchanged:i,remove:j,clear:k,cacheresethint:k,rootchange:k,priority:100,destroyable:!0})}var b=this,c=a.getResourceStore();b.callParent(),b.eventStoreDetacher=a.on({add:d,remove:e,update:f,clear:g,cacheresethint:g,rootchange:g,resourcestorechange:h,priority:100,destroyable:!0}),b.eventStoreFiltersDetacher=a.getFilters().on("endupdate",g,this,{priority:1002,destroyable:!0}),l(c),b.eventStore=a},destroy:function(){var a=this;Ext.destroyMembers(a,"eventStoreDetacher","eventStoreFiltersDetacher","resourceStoreDetacher"),a.eventStore=null},get:function(a,b){var c=this;return a=c.key(a),b=b||function(){return Ext.Array.filter(c.eventStore.getRange(),function(b){return b.getResourceId()==a})},c.callParent([a,b])}}),Ext.ClassManager.get("Sch.data.mixin.UniversalModelGetter")||Ext.define("Sch.data.mixin.UniversalModelGetter",{getModelById:function(a){var b=this;return b.getNodeById?b.getNodeById(a):b.getById(a)},getModelByInternalId:function(a){var b=this;return b.byInternalIdMap?b.byInternalIdMap[a]:b.getByInternalId(a)}}),Ext.ClassManager.get("Sch.data.mixin.CacheHintHelper")||Ext.define("Sch.data.mixin.CacheHintHelper",{
extend:"Ext.Mixin",mixinConfig:{before:{loadRecords:"loadRecords"}},loadRecords:function(){var a=this;a.fireEvent("cacheresethint",a)}}),Ext.ClassManager.get("Sch.data.mixin.EventStore")||Ext.define("Sch.data.mixin.EventStore",{extend:"Ext.Mixin",requires:["Sch.util.Date","Sch.data.util.IdConsistencyManager","Sch.data.util.ModelPersistencyManager","Sch.data.util.ResourceEventsCache"],isEventStore:!0,resourceStore:null,resourceStoreDetacher:null,assignmentStore:null,resourceEventsCache:null,idConsistencyManager:null,modelPersistencyManager:null,mixinConfig:{after:{constructor:"constructor",destroy:"destroy"}},constructor:function(){var a=this;a.resourceEventsCache=a.createResourceEventsCache(),a.idConsistencyManager=a.createIdConsistencyManager(),a.modelPersistencyManager=a.createModelPersistencyManager()},destroy:function(){var a=this;Ext.destroyMembers(a,"resourceEventsCache","idConsistencyManager","modelPersistencyManager")},createResourceEventsCache:function(){return new Sch.data.util.ResourceEventsCache(this)},createIdConsistencyManager:function(){var a=this;return new Sch.data.util.IdConsistencyManager({eventStore:a,resourceStore:a.getResourceStore(),assignmentStore:a.getAssignmentStore()})},createModelPersistencyManager:function(){var a=this;return new Sch.data.util.ModelPersistencyManager({eventStore:a,resourceStore:a.getResourceStore(),assignmentStore:a.getAssignmentStore()})},getResourceStore:function(){return this.resourceStore},setResourceStore:function(a){var b=this,c=b.resourceStore;b.resourceStore&&(b.resourceStore.setEventStore(null),b.idConsistencyManager&&b.idConsistencyManager.setResourceStore(null),b.modelPersistencyManager&&b.modelPersistencyManager.setResourceStore(null)),b.resourceStore=a&&Ext.StoreMgr.lookup(a)||null,b.resourceStore&&(b.modelPersistencyManager&&b.modelPersistencyManager.setResourceStore(b.resourceStore),b.idConsistencyManager&&b.idConsistencyManager.setResourceStore(b.resourceStore),a.setEventStore(b)),(c||a)&&c!==a&&b.fireEvent("resourcestorechange",b,a,c)},getAssignmentStore:function(){return this.assignmentStore},setAssignmentStore:function(a){var b=this,c=b.assignmentStore;b.assignmentStore&&(b.assignmentStore.setEventStore(null),b.idConsistencyManager&&b.idConsistencyManager.setAssignmentStore(null),b.modelPersistencyManager&&b.modelPersistencyManager.setAssignmentStore(null)),b.assignmentStore=a&&Ext.StoreMgr.lookup(a)||null,b.assignmentStore?(b.modelPersistencyManager&&b.modelPersistencyManager.setAssignmentStore(b.assignmentStore),b.idConsistencyManager&&b.idConsistencyManager.setAssignmentStore(b.assignmentStore),b.assignmentStore.setEventStore(b),Ext.destroy(b.resourceEventsCache)):b.resourceEventsCache=b.createResourceEventsCache(),(c||a)&&c!==a&&b.fireEvent("assignmentstorechange",b,a,c)},isDateRangeAvailable:function(a,b,c,d){var e=Sch.util.Date,f=this.getEventsForResource(d),g=!0;return Ext.each(f,function(d){return g=c===d||!e.intersectSpans(a,b,d.getStartDate(),d.getEndDate())}),g},getEventsInTimeSpan:function(a,b,c){var d=new Ext.util.MixedCollection,e=[];if(c!==!1){var f=Sch.util.Date;this.forEachScheduledEvent(function(c,d,g){f.intersectSpans(d,g,a,b)&&e.push(c)})}else this.forEachScheduledEvent(function(c,d,f){d-a>=0&&b-f>=0&&e.push(c)});return d.addAll(e),d},forEachScheduledEvent:function(a,b){this.each(function(c){var d=c.getStartDate(),e=c.getEndDate();if(d&&e)return a.call(b||this,c,d,e)},this)},getTotalTimeSpan:function(){var a=new Date(9999,0,1),b=new Date(0),c=Sch.util.Date;return this.each(function(d){d.getStartDate()&&(a=c.min(d.getStartDate(),a)),d.getEndDate()&&(b=c.max(d.getEndDate(),b))}),a=a<new Date(9999,0,1)?a:null,b=b>new Date(0)?b:null,this.lastTotalTimeSpan={start:a||null,end:b||a||null},this.lastTotalTimeSpan},filterEventsForResource:function(a,b,c){var d=a.getEvents(this);return Ext.Array.filter(d,b,c||this)},append:function(a){throw"Must be implemented by consuming class"},getResourcesForEvent:function(a){var e,b=this,c=b.getAssignmentStore(),d=b.getResourceStore();return c?e=c.getResourcesForEvent(a):d?(a=a instanceof Sch.model.Event&&a||b.getModelById(a),e=a&&d.getModelById(a.getResourceId()),e=e&&[e]||[]):e=[],e},getEventsForResource:function(a){var e,b=this,c=b.getAssignmentStore();return e=c?c.getEventsForResource(a):b.resourceEventsCache?b.resourceEventsCache.get(a):[]},getAssignmentsForEvent:function(a){var b=this,c=b.getAssignmentStore();return c&&c.getAssignmentsForEvent(a)||[]},getAssignmentsForResource:function(a){var b=this,c=b.getAssignmentStore();return c&&c.getAssignmentsForResource(a)||[]},assignEventToResource:function(a,b){var c=this,d=c.getAssignmentStore();d?d.assignEventToResource(a,b):(a=a instanceof Sch.model.Event&&a||c.getModelById(a),b=b instanceof Sch.model.Resource?b.getId():b,a&&a.setResourceId(b))},unassignEventFromResource:function(a,b){var c=this,d=c.getAssignmentStore();d?d.unassignEventFromResource(a,b):(a=a instanceof Sch.model.Event&&a||c.getModelById(a),b=b instanceof Sch.model.Resource?b.getId():b,a&&a.getResourceId()==b&&a.setResourceId(null))},reassignEventFromResourceToResource:function(a,b,c){var d=this,e=d.getAssignmentStore();e?(e.unassignEventFromResource(a,b),e.assignEventToResource(a,c)):(a=a instanceof Sch.model.Event&&a||d.getModelById(a),b=b instanceof Sch.model.Resource?b.getId():b,c=c instanceof Sch.model.Resource?c.getId():c,a.getResourceId()==b&&a.setResourceId(c))},isEventAssignedToResource:function(a,b){var e,c=this,d=c.getAssignmentStore();return d?e=d.isEventAssignedToResource(a,b):(a=a instanceof Sch.model.Event&&a||c.getModelById(a),b=b instanceof Sch.model.Resource?b.getId():b,e=a&&a.getResourceId()==b||!1),e},removeAssignmentsForEvent:function(a){var b=this,c=b.getAssignmentStore();c?c.removeAssignmentsForEvent(a):(a=a instanceof Sch.model.Event&&a||b.getModelById(a),a&&a.setResourceId(null))},removeAssignmentsForResource:function(a){var b=this,c=b.getAssignmentStore(),d=b.getResourceStore();c?c.removeAssignmentsForResource(a):d?(a=a instanceof Sch.model.Resource&&a||d.getModelById(a),a&&Ext.Array.forEach(b.resourceEventsCache.get(a),function(a){a.setResourceId(null)})):(a=a instanceof Sch.model.Resource?a.getId():a,Ext.Array.forEach(b.getRange(),function(b){b.getResourceId()==a&&b.setResourceId(null)}))},isEventPersistable:function(a){var d,e,f,b=this,c=b.getAssignmentStore(),g=!0;if(!c)for(d=a.getResources(),e=0,f=d.length;g&&e<f;++e)g=d[e].phantom!==!0;return g}}),Ext.ClassManager.get("Sch.data.mixin.ResourceStore")||Ext.define("Sch.data.mixin.ResourceStore",{eventStore:null,getEventStore:function(){return this.eventStore},setEventStore:function(a){var c,b=this;b.eventStore!==a&&(c=b.eventStore,b.eventStore=a&&Ext.StoreMgr.lookup(a)||null,b.fireEvent("eventstorechange",b,a,c))}}),Ext.ClassManager.get("Sch.data.EventStore")||Ext.define("Sch.data.EventStore",{extend:"Ext.data.Store",alias:"store.eventstore",mixins:["Sch.data.mixin.UniversalModelGetter","Sch.data.mixin.CacheHintHelper","Sch.data.mixin.EventStore"],storeId:"events",model:"Sch.model.Event",config:{model:"Sch.model.Event"},proxy:"memory",constructor:function(a){var b=this;if(b.callParent([a]),b.resourceStore&&b.setResourceStore(b.resourceStore),b.assignmentStore&&b.setAssignmentStore(b.assignmentStore),b.getModel()!==Sch.model.Event&&!(b.getModel().prototype instanceof Sch.model.Event))throw"The model for the EventStore must subclass Sch.model.Event"},append:function(a){this.add(a)}}),Ext.ClassManager.get("Sch.data.ResourceStore")||Ext.define("Sch.data.ResourceStore",{extend:"Ext.data.Store",model:"Sch.model.Resource",config:{model:"Sch.model.Resource"},alias:"store.resourcestore",requires:["Sch.patches.OperationDestroy"],mixins:["Sch.data.mixin.UniversalModelGetter","Sch.data.mixin.CacheHintHelper","Sch.data.mixin.ResourceStore"],storeId:"resources",proxy:"memory",constructor:function(){if(this.callParent(arguments),this.getModel()!==Sch.model.Resource&&!(this.getModel().prototype instanceof Sch.model.Resource))throw"The model for the ResourceStore must subclass Sch.model.Resource"}}),Ext.define("Kanban.locale.Ko",{extend:"Sch.locale.Locale",singleton:!0,constructor:function(a){Ext.apply(this,{l10n:{"Kanban.menu.TaskMenuItems":{copy:"복사",remove:"삭제",edit:"수정",states:"이동",users:"배차"}},NotStarted:"대기",InProgress:"진행중",Test:"검사",Done:"완료"}),this.callParent(arguments)}}),Ext.define("Kanban.model.Resource",{extend:"Sch.model.Resource",customizableFields:[{name:"ImageUrl"}],imageUrlField:"ImageUrl"}),Ext.define("Kanban.model.Task",{extend:"Sch.model.Event",resourceStore:null,states:["NotStarted","InProgress","Test","Done"],customizableFields:[{name:"State",defaultValue:"NotStarted"},{name:"Position",type:"int"},{name:"CreatedDate",type:"date"},{name:"ImageUrl"}],constructor:function(){this.callParent(arguments),this.phantom&&!this.getCreatedDate()&&this.setCreatedDate(new Date)},stateField:"State",imageUrlField:"ImageUrl",createdDateField:"CreatedDate",positionField:"Position",getResourceStore:function(){return this.resourceStore||Ext.Array.each(this.joined,function(a){if(a.resourceStore)return this.resourceStore=a.resourceStore,!1},this),this.resourceStore},isValidTransition:function(a){switch(this.getState()){case"NotStarted":return"InProgress"==a;case"InProgress":return"Done"!=a;case"Test":return"NotStarted"!=a;case"Done":return"Test"==a||"InProgress"==a;default:return!0}}}),Ext.define("Kanban.data.mixin.StoreView",{state:null,masterStore:null,bindToStore:function(a){var b={add:this.onMasterAdd,clear:this.onMasterClear,remove:this.onMasterRemove,update:this.onMasterUpdate,refresh:this.onMasterDataChanged,scope:this};this.masterStore&&this.masterStore.un(b),this.masterStore=a,a&&(a.on(b),this.copyStoreContent())},onMasterAdd:function(a,b){for(var c=0;c<b.length;c++)b[c].getState()===this.state&&this.add(b[c])},onMasterClear:function(){this.removeAll()},onMasterUpdate:function(a,b,c,d){d&&Ext.Array.indexOf(d,a.model.prototype.stateField)>=0&&(this.state===b.getState()&&this.add(b),this.state===b.previous[b.stateField]&&this.remove(b))},onMasterRemove:function(a,b){Ext.Array.each(b,function(a){a.getState()===this.state&&this.remove(a)},this)},onMasterDataChanged:function(a){this.copyStoreContent()},copyStoreContent:function(){var a=this.state,b=[];this.masterStore.each(function(c){c.getState()===a&&(b[b.length]=c)}),this.suspendEvents(),this.sort(this.masterStore.getSorters().items),this.sorters.removeAll(),this.resumeEvents(),this.loadData(b)}}),Ext.define("Kanban.data.ViewStore",{extend:"Ext.data.Store",mixins:["Kanban.data.mixin.StoreView"],proxy:"memory",masterStore:null,state:null,constructor:function(a){if(Ext.apply(this,a),null===this.state||void 0===this.state)throw"Must supply state";if(!this.masterStore)throw"Must supply a master store";var b=this.masterStore=Ext.StoreMgr.lookup(this.masterStore);b.sorters;this.model=b.model,this.callParent(arguments),this.masterStore&&this.bindToStore(this.masterStore)},getResourceStore:function(){return this.masterStore.getResourceStore()}}),Ext.define("Kanban.data.ResourceStore",{extend:"Sch.data.ResourceStore",model:"Kanban.model.Resource",sorters:"Name",proxy:void 0,alias:"store.kanban_resourcestore"}),Ext.define("Kanban.data.TaskStore",{extend:"Sch.data.EventStore",model:"Kanban.model.Task",proxy:void 0,alias:"store.kanban_taskstore",resourceStore:null,setResourceStore:function(a){this.resourceStore=Ext.data.StoreManager.lookup(a)},getResourceStore:function(){return this.resourceStore},constructor:function(){this.callParent(arguments);var a=this.getModel();this.setSorters([{property:a.prototype.positionField,direction:"ASC"},{property:a.prototype.nameField,direction:"ASC"}])}}),Ext.define("Kanban.dd.DragZone",{extend:"Ext.dd.DragZone",mixins:{observable:"Ext.util.Observable"},requires:["Ext.util.Point"],panel:null,repairHighlight:!1,repairHighlightColor:"transparent",containerScroll:!1,autoOffset:function(a,b){this.setDelta(this.dragData.offsets[0],this.dragData.offsets[1])},setVisibilityForSourceEvents:function(a){Ext.each(this.dragData.taskEls,function(b){b[a?"removeCls":"addCls"]("sch-hidden")})},constructor:function(a){Ext.isIE8m&&window.top!==window&&(Ext.dd.DragDropManager.notifyOccluded=!0),this.mixins.observable.constructor.call(this,a),this.callParent(arguments),this.proxy.el.child(".x-dd-drag-ghost").removeCls("x-dd-drag-ghost"),this.proxy.addCls("sch-task-dd")},getPlaceholderElements:function(a,b){var d,c=b.taskEls,h=(b.offsets[0],b.offsets[1],a.getHeight(),Ext.core.DomHelper.createDom({tag:"div",cls:"sch-dd-wrap-holder"}));return Ext.Array.each(c,function(a,b){d=a.dom.cloneNode(!0),d.innerHTML="",d.id=Ext.id(),d.boundView=a.dom.boundView;var c=Ext.fly(d);c.removeCls("sch-task-selected"),c.addCls("sch-task-placeholder"),h.appendChild(d),Ext.fly(d).setStyle({width:a.getWidth()+"px",height:a.getHeight()+"px"})}),h},getDragData:function(a){var b=this.panel,c=a.getTarget(b.taskSelector);if(c&&!b.isReadOnly()){var d=b.resolveRecordByNode(c);if(!d||d.isDraggable()===!1||this.fireEvent("beforetaskdrag",this,d,a)===!1)return null;var e=a.getXY(),f=Ext.get(c),g=f.getXY(),h=[e[0]-g[0],e[1]-g[1]],i=Ext.getCmp(f.up(".sch-taskview").id);f.getRegion();i.isSelected(c)||a.ctrlKey||this.fireEvent("taskdragstarting",this,d,a);var k=this.getDraggingRecords(d),l=[];Ext.Array.forEach(k,function(a){var c=b.getElementForTask(a);c&&l.push(c)});var m={view:i,sourceZoomLevel:i.up("panel").zoomLevel,offsets:h,repairXY:[a.getX()-h[0],a.getY()-h[1]],taskEls:l,bodyScroll:Ext.getBody().getScroll(),taskRecords:k},n=i.getStore(),o=n.getAt(n.indexOf(d)+1);return o&&(m.dropOptions={task:o,type:"before"}),m.ddel=this.getDragElement(f,m),m.placeholder=this.getPlaceholderElements(f,m),this.proxy.el.set({size:this.panel.getZoomLevel()}),m}},onStartDrag:function(a,b){var c=this.dragData;Ext.fly(c.placeholder).insertBefore(c.taskEls[0]),Ext.Array.forEach(c.taskEls,function(a){a.addCls("sch-hidden")}),this.fireEvent("taskdragstart",this,c.taskRecords)},getDraggingRecords:function(a){var b=this.getRelatedRecords(a);a.store;return b=b[0]&&b[0].getState()==a.getState()?Ext.Array.sort([a].concat(b),this.positionSorter):[a].concat(Ext.Array.sort(b,this.positionSorter))},positionSorter:function(a,b){var c=a.store;return c.indexOf(a)>c.indexOf(b)?1:-1},getRelatedRecords:function(a){var b=this.panel,c=b.getSelectedRecords(),d=[];return Ext.each(c,function(b){b.getId()!==a.getId()&&d.push(b)}),d},getDragElement:function(a,b){var d,c=b.taskEls,g=(b.offsets[0],b.offsets[1],this.panel.getElementForTask(b.taskRecords[0]).getHeight());if(c.length>1){var h=Ext.core.DomHelper.createDom({tag:"div",cls:"sch-dd-wrap",style:{overflow:"visible"}});return Ext.Array.forEach(c,function(a,b){d=a.dom.cloneNode(!0),d.id="",d.className+=0===b?" sch-dd-source":" sch-dd-extra";var c=a.up("[size]"),e=Ext.core.DomHelper.createDom({tag:"div",size:c.getAttribute("size")}).cloneNode(!0);e.appendChild(d),h.appendChild(e),Ext.fly(d).setStyle({left:(b>0?10:0)+"px",top:(0===b?0:g-30+20*b)+"px",width:a.getWidth()+"px",height:a.getHeight()+"px",position:"absolute"})}),h}d=a.dom.cloneNode(!0),d.id="",d.style.width=a.getWidth()+"px",d.style.height=a.getHeight()+"px";var i=a.up("[size]"),j=Ext.core.DomHelper.createDom({tag:"div",size:i.getAttribute("size")}).cloneNode(!0);return j.appendChild(d),j},getRepairXY:function(a,b){return b.repairXY},afterRepair:function(){this.dragging=!1},onInvalidDrop:function(a,b,c){b||(b=a,a=b.getTarget()||document.body);var d=this.callParent([a,b,c]);return this.fireEvent("aftertaskdrop",this,this.dragData.taskRecords),this.dragData.placeholder&&Ext.fly(this.dragData.placeholder).remove(),this.setVisibilityForSourceEvents(!0),d}}),Ext.define("Kanban.dd.DropZone",{extend:"Ext.dd.DropZone",mixins:{observable:"Ext.util.Observable"},constructor:function(a){this.callParent(arguments),this.mixins.observable.constructor.call(this,a)},panel:null,dragData:null,getTargetFromEvent:function(a){return a.getTarget()},validatorFn:Ext.emptyFn,validatorFnScope:null,zoomLevels:["large","medium","small","mini"],shouldDropBeforeNode:function(a,b,c){var f,d=Ext.fly(b).getBox(),e=c.proxy.getXY();if("vertical"==this.dropMode){if(f=(d.bottom-d.top)/2,this.direction.up)return e[1]-d.top<f;var g=Ext.fly(c.dragData.placeholder.children[0]).getHeight();return e[1]+g-d.top<f}if(f=(d.right-d.left)/2,Ext.Array.indexOf(this.zoomLevels,c.dragData.currentZoomLevel)>Ext.Array.indexOf(this.zoomLevels,c.dragData.sourceZoomLevel))return a[1]<d.top||!(a[1]>d.bottom)&&a[0]-d.left<(d.right-d.left)/2;if(a[1]<d.top)return!0;if(a[1]>d.bottom)return!1;if(this.direction.left)return e[0]-d.left<f;var h=Ext.fly(c.dragData.placeholder.children[0]).getWidth();return e[0]+h-d.left<f},getDropMode:function(a){var b=Ext.DomQuery.select(a.getItemSelector()+":not(.sch-hidden)",a.el.dom)[0];return b&&2*Ext.fly(b).getWidth()<a.getWidth()?"horizontal":"vertical"},updatePlaceholderElements:function(a,b){for(var c,d=Ext.core.DomHelper.createDom({tag:"div",cls:"sch-dd-wrap-holder"}),e=0,f=b.taskRecords.length;e<f;e++){c=a.cloneNode(!0),c.innerHTML="",c.boundView=a.boundView,c.id=Ext.id();var g=Ext.fly(c);g.removeCls("sch-task-selected"),g.addCls("sch-task-placeholder"),d.appendChild(c),Ext.fly(c).setStyle({width:a.offsetWidth+"px",height:a.offsetHeight+"px"})}return d},getSmallestTask:function(a){for(var b=Ext.DomQuery.select(a.getItemSelector()+":not(.sch-hidden)",a.el.dom),c=b[0],d=0;d<b.length;d++)c=c.offsetHeight>b[d].offsetHeight?b[d]:c;return c},getNodeByCoordinate:function(a,b){return document.elementFromPoint(a[0]-b.left,a[1]-b.top)},getTargetView:function(a,b,c){var d=this.getNodeByCoordinate(a,c.bodyScroll);if(Ext.isIE8&&b&&(d=this.getNodeByCoordinate(a,c.bodyScroll)),d){if(!d.className.match("sch-taskview")){var e=Ext.fly(d).up(".sch-taskview");d=e?e.dom:null}if(d)return Ext.getCmp(d.id)}return null},onNodeOver:function(a,b,c,d){var e=c.getXY();this.direction={left:!1,up:!1};var f=this.prevXY;f&&(f[0]>e[0]&&(this.direction.left=!0),f[1]>e[1]&&(this.direction.up=!0)),this.prevXY=e;var g=b.proxy.el.dom,h=!1;g.style.display="none";var i=this.getTargetView(e,c,d);if(g.style.display="block",!i)return this.dropNotAllowed;if(i&&(h=d.taskRecords[0].isValidTransition(i.state))){if(i!=d.view){var j=this.getSmallestTask(i);j&&(Ext.fly(d.placeholder).remove(),d.placeholder=this.updatePlaceholderElements(j,d))}i==d.view&&this.dropMode||(this.dropMode=this.getDropMode(i),d.currentZoomLevel=i.up("panel").zoomLevel),d.view=i;var o,p,q,k=Ext.get(d.placeholder),l=i.all.elements.slice(),m=0,n=l.length-1;if(l.length){for(;n-m>1;)p=Math.floor((m+n)/2),o=l[p],Ext.fly(o).isVisible()?(q=this.shouldDropBeforeNode(e,o,b),q?n=p:m=p):(l.splice(p,1),n-=1);var r=l[m],s=this.shouldDropBeforeNode(e,r,b);s?(o=r,q=!0):Ext.fly(l[n]).isVisible()?(o=l[n],q=this.shouldDropBeforeNode(e,o,b)):(o=r,q=!1)}o?q?(k.insertBefore(o),d.dropOptions={task:i.getRecord(o),type:"before"}):(k.insertAfter(o),d.dropOptions={task:i.getRecord(o),type:"after"}):(i.el.appendChild(k),d.dropOptions=null)}return h?this.dropAllowed:this.dropNotAllowed},notifyDrop:function(a,b,c){var d=b.getXY();a.proxy.el.dom.style.display="none";var e=this.getTargetView(d,b,c);a.proxy.el.dom.style.display="block";var f=this,g=e&&e.state,h=!0,i=g!==!1&&null!==g;return c.newState=g,c.view=e,c.proxy=a.proxy,c.finalize=function(){f.finalize.apply(f,arguments)},i=i&&f.validatorFn.call(f.validatorFnScope||this,c.taskRecords,g)!==!1,this.dragData=c,h=f.fireEvent("beforetaskdropfinalize",f,c,b)!==!1,!h||f.finalize(i)},finalize:function(a){var b=this.dragData,c=b.proxy,d=[];if(Ext.fly(this.getEl()).select(".sch-dd-wrap-holder").remove(),Ext.Array.forEach(b.taskEls,function(a){a.removeCls("sch-hidden")}),a){var e=b.taskRecords,f=e[0].positionField,g=b.newState,h=b.dropOptions,i=b.view.getStore();if(Ext.Array.each(e,function(a){a.isValidTransition(g)&&(a.setState(g),d.push(a))}),d.length>0){i.remove(d);var j=h?i.indexOf(h.task)+("before"==h.type?0:1):i.getCount();i.insert(j,d);for(var k=0;k<i.getCount();k++)i.getAt(k).set(f,k,{silent:!0});i.sort(this.masterStoreSorters)}}return 0===d.length?(c.el.dom.style.display="block",c.el.animate({duration:500,easing:"ease-out",to:{x:b.repairXY[0],y:b.repairXY[1]},stopAnimation:!0})):this.fireEvent("taskdrop",this,b.taskRecords),delete this.dropMode,this.fireEvent("aftertaskdrop",this,b.taskRecords),b.placeholder&&Ext.fly(b.placeholder).remove(),d.length>0}}),Ext.define("Kanban.field.AddNew",{extend:"Ext.form.TextField",alias:"widget.addnewfield",enableKeyEvents:!0,emptyText:"Add new task...",store:null,defaults:null,initComponent:function(){this.on("keyup",this.onMyKeyUp,this),Ext.isString(this.store)&&(this.store=Ext.getStore(this.store)),this.callParent(arguments)},onMyKeyUp:function(a,b){b.getKey()===b.ENTER&&this.addTask()},addTask:function(){var a={};a[this.store.model.prototype.nameField]=this.getValue(),this.store.add(Ext.apply(a,this.defaults)),this.setValue()}}),Ext.define("Kanban.field.TaskFilter",{extend:"Ext.form.TextField",alias:"widget.filterfield",requires:["Ext.util.Filter"],enableKeyEvents:!0,height:26,minLength:2,store:null,caseSensitive:!1,initComponent:function(){this.on("change",this.onMyChange,this),this.store=Ext.data.StoreManager.lookup(this.store),this.field=this.field||this.store.getModel().prototype.nameField,this.filter=new Ext.util.Filter({id:this.getId()+"-filter",property:this.field,value:"",caseSensitive:this.caseSensitive,anyMatch:!0}),this.callParent(arguments)},onMyChange:function(){var a=this.getValue();a&&a.length>=this.minLength?(this.filter.setValue(a),this.store.addFilter(this.filter)):this.store.removeFilter(this.filter)}}),Ext.define("Kanban.field.TaskHighlight",{extend:"Ext.form.TextField",alias:"widget.highlightfield",mixins:["Ext.AbstractPlugin"],enableKeyEvents:!0,minLength:2,preventMark:!0,height:26,panel:null,field:"Name",caseSensitive:!1,initComponent:function(){this.on("keyup",this.onMyKeyUp,this),this.callParent(arguments)},onMyKeyUp:function(a,b){var c=this.getValue();if(c&&c.length>=this.minLength){c=this.caseSensitive?c:c.toLowerCase(),this.panel.highlightTasksBy(function(a){var b=this.caseSensitive?a.data[this.field]:a.data[this.field].toLowerCase();return b&&b.indexOf(c)>=0},this)}else this.panel.clearHighlight()}}),Ext.define("Kanban.field.ColumnFilter",{extend:"Ext.form.ComboBox",alias:"widget.columnfilter",requires:["Ext.data.JsonStore"],multiSelect:!0,valueField:"id",displayField:"name",panel:null,queryMode:"local",listConfig:{cls:"sch-columnfilter-list"},initComponent:function(){this.store=new Ext.data.JsonStore({proxy:"memory",fields:["id","name"]}),this.updateListItems(!0),this.callParent(arguments),this.getPicker().on({beforeshow:this.onMyBeforeExpand,scope:this}),this.getPicker().on({show:function(a){a.on("selectionchange",this.onMySelect,this)},hide:function(a){a.un("selectionchange",this.onMySelect,this)},delay:50,scope:this})},updateListItems:function(a){var b=Sch.locale.Active["Kanban.locale"]||{},c=[],d=[];Ext.each(this.panel.query("taskcolumn"),function(e){c.push({id:e.state,name:e.origTitle||b[e.state]||e.state}),a&&!e.hidden&&d.push(e.state)}),a&&(this.value=this.value||d),this.store.loadData(c),a||this.onMyBeforeExpand()},onMySelect:function(a,b){this.store.each(function(a){this.panel.down("[state="+a.get("id")+"]")[Ext.Array.indexOf(b,a)>=0?"show":"hide"]()},this)},onMyBeforeExpand:function(){var a=this.panel,b=this,c=[];Ext.each(a.query("taskcolumn"),function(a){a.isVisible()&&c.push(b.store.getById(a.state))}),b.select(c)}}),Ext.define("Kanban.editor.Base",{triggerEvent:"taskdblclick",panel:null,selector:".sch-task",editRecord:function(a,b){if(!this.panel.isReadOnly()){var c=this.panel.getElementForTask(a);c&&this.triggerEdit(a,b)}},triggerEdit:function(a,b){throw"Abstract method call"},init:function(a){this.panel=a,this.triggerEvent&&(a.on(this.triggerEvent,function(a,b,c,d){this.editRecord(b,d)},this),a.on("taskkeydown",function(a,b,c,d){d.getKey()===d.ENTER&&"input"!==d.getTarget().nodeName.toLowerCase()&&this.editRecord(b,d)},this))}}),Ext.define("Kanban.editor.SimpleEditor",{extend:"Ext.Editor",mixins:["Kanban.editor.Base"],alias:"widget.kanban_simpleeditor",alignment:"tl",autoSize:{width:"boundEl"},listeners:{complete:"onEditDone"},selector:".sch-task-name",dataIndex:"Name",field:{xtype:"textfield",minWidth:100,allowEmpty:!1},triggerEdit:function(a){var b=this.panel.getElementForTask(a);if(b){this.record=a;var c=b.down(this.selector);if(null!=c)this.startEdit(c);else try{gUtil.editRackRecord(a)}catch(a){console.log("triggerEdit e",a)}}},onEditDone:function(){this.record.set(this.dataIndex,this.getValue())}}),Ext.define("Kanban.menu.UserMenu",{extend:"Ext.menu.Menu",alias:"widget.kanban_usermenu",cls:"sch-usermenu",plain:!0,resourceStore:null,initComponent:function(){Ext.apply(this,{renderTo:document.body,listeners:{beforeshow:function(){var a=this.task.getResource();a&&this.items.each(function(b){a==b.user?b.addCls("sch-user-selected"):b.removeCls("sch-user-selected")})}}}),this.resourceStore=Ext.data.StoreManager.lookup(this.resourceStore),this.mon(this.resourceStore,{load:this.populate,add:this.populate,remove:this.populate,update:this.populate,scope:this}),this.callParent(arguments),this.populate()},showForTask:function(a,b){this.task=a,this.showAt(b)},onUserSelected:function(a){this.task.assign(a.user)},populate:function(){var a=this,b=[];this.resourceStore.each(function(c){b.push({text:c.getName(),user:c,handler:a.onUserSelected,scope:a})}),this.removeAll(!0),this.add(b)}}),Ext.define("Kanban.menu.UserPicker",{extend:"Ext.view.View",alias:["widget.userpicker","widget.kanban_userpicker"],cls:"sch-userpicture-view",autoScroll:!0,showName:!0,padding:"10 5 5 5",itemSelector:".sch-user",overItemCls:"sch-user-hover",selectedItemCls:"sch-user-selected",initComponent:function(){var a=this.store&&this.store.model&&this.store.model.prototype,b=a&&a.nameField||"Name",c=a&&a.imageUrlField||"ImageUrl";Ext.apply(this,{itemTpl:'<tpl for="."><div class="sch-user"><img src="{'+c+':htmlEncode}" />'+(this.showName?"<span>{"+b+":htmlEncode}</span>":"")+"</div></tpl>"}),this.callParent(arguments)}}),Ext.define("Kanban.menu.UserPictureMenu",{extend:"Ext.menu.Menu",alias:["widget.userpicturemenu","widget.kanban_userpicturemenu"],requires:["Kanban.menu.UserPicker"],cls:"sch-userpicturemenu",width:290,height:200,resourceStore:null,hideOnSelect:!0,initComponent:function(){var a=this,b=Ext.apply({},a.initialConfig);delete b.listeners,Ext.apply(a,{plain:!0,showSeparator:!1,bodyPadding:0,items:Ext.applyIf({margin:0,store:this.resourceStore,xtype:"userpicker"},b)}),a.callParent(arguments),a.picker=a.down("userpicker"),a.relayEvents(a.picker,["select"]),a.hideOnSelect&&a.on("select",a.onUserSelected,a),this.mon(Ext.getBody(),"click",this.onBodyClick,this)},showForTask:function(a,b){this.task=a,this.showAt(b);var c=a.getResource();c?this.picker.select(c,!1,!0):this.picker.getSelectionModel().deselectAll()},onUserSelected:function(a,b){this.hide(),this.task.assign(b)},onBodyClick:function(a,b){a.within(this.el)||this.hide()}}),Ext.define("Kanban.menu.TaskMenuItems",{requires:["Kanban.editor.SimpleEditor","Kanban.menu.UserMenu"],mixins:["Sch.mixin.Localizable"],taskBoard:null,mainMenu:null,defaultActions:null,editorClass:null,editor:null,userMenuClass:null,userMenu:null,constructor:function(a){Ext.apply(this,a),this.mainMenu.on("beforeshow",this.onBeforeShow,this),this.items=this.items||[],this.defaultActions&&(this.initEditor(),this.initUserMenu(),this.initStateMenu(),this.items=this.items.concat([{action:"edit",text:this.L("edit"),handler:this.onEditClick,scope:this},{action:"assign",text:this.L("users"),menu:this.userMenu},{action:"setState",text:this.L("states"),menu:this.stateMenu},{action:"copy",text:this.L("copy"),handler:this.onCopyClick,scope:this},{action:"remove",text:this.L("remove"),handler:this.onRemoveClick,scope:this}])),this.callParent(arguments)},onBeforeShow:function(a){var b=a.getTask();this.userMenu&&(this.userMenu.task=b),this.editor&&(this.editor.task=b)},getItems:function(){return this.items},initEditor:function(){this.editor||(this.taskBoard.getTaskEditor()?this.editor=this.taskBoard.getTaskEditor():this.editor=Ext.create(this.editorClass,{dataIndex:this.taskBoard.taskStore.model.prototype.nameField,panel:this.taskBoard}))},onEditClick:function(a,b){this.editor.editRecord(this.mainMenu.getTask(),b)},initUserMenu:function(){this.userMenu||(this.userMenu=Ext.create(this.userMenuClass,{resourceStore:this.taskBoard.resourceStore,onBodyClick:Ext.emptyFn}))},initStateMenu:function(){var a=this,b=this.taskBoard.taskStore.model,c=b.prototype.stateField,d=b.prototype.states,e=Sch.locale.Active["Kanban.locale"]||{},f=Ext.Array.map(d,function(b){return{text:e[b]||b,state:b,handler:a.onStateClick,scope:a}}),g=a.mainMenu;this.stateMenu=new Ext.menu.Menu({items:f,plain:!0,listeners:{show:function(){var a=g.getTask().get(c);this.items.each(function(b){b.setDisabled(b.state===a)})}}})},onStateClick:function(a){this.mainMenu.task.setState(a.state)},onCopyClick:function(a){var b=this.taskBoard.taskStore,c=this.mainMenu.getTask(),d=c.copy(null);d.setName(d.getName()),b.add(d)},onRemoveClick:function(a){var b=this.taskBoard.taskStore,c=this.mainMenu.getTask();b.remove(c)}}),Ext.define("Kanban.menu.TaskMenu",{extend:"Ext.menu.Menu",requires:["Kanban.menu.TaskMenuItems"],isTaskMenu:!0,alias:"widget.kanban_taskmenu",cls:"sch-task-menu",handleCls:"sch-task-menu-handle",taskBoard:null,config:{task:null},hideHandleTimer:null,handleHideDelay:500,currentHandle:null,editorClass:"Kanban.editor.SimpleEditor",userMenuClass:"Kanban.menu.UserMenu",defaultActions:!0,itemFactoryClass:"Kanban.menu.TaskMenuItems",initComponent:function(){this.on("beforeshow",this.onBeforeShow,this),this.defaultActions&&(this.items=Ext.create(this.itemFactoryClass,{editorClass:this.editorClass,userMenuClass:this.userMenuClass,defaultActions:this.defaultActions,items:this.items||[],taskBoard:this.taskBoard,mainMenu:this}).getItems()),this.callParent(arguments)},registerListeners:function(){this.mon(this.taskBoard.el,{click:this.onMenuHandleClick,delegate:"."+this.handleCls,scope:this}),this.mon(this.taskBoard,{taskmouseenter:this.onHandleMouseOver,taskmouseleave:this.onHandleMouseLeave,scope:this})},showForTask:function(a,b,c){var d=b.getTarget(".sch-task");this.setTask(a),this.show(),this.alignTo(d,"tl-tr?")},onMenuHandleClick:function(a,b){var c=this.taskBoard.resolveRecordByNode(b);a.stopEvent(),this.showForTask(c,a,b)},onHandleMouseOver:function(a,b,c,d,e){window.clearTimeout(this.hideHandleTimer),this.hide(),this.currentHandle&&this.currentHandle.setVisible(!1),this.currentHandle=Ext.select("."+this.handleCls,!1,c).setVisible(!0)},onHandleMouseLeave:function(a,b,c,d,e){this.hideHandleTimer=Ext.defer(function(){this.currentHandle.setVisible(!1)},this.handleHideDelay,this)},shouldShowItem:function(a,b){return!0},onBeforeShow:function(a){var b=this.getTask();this.items.each(function(a){a.task=b,a.setVisible(this.shouldShowItem(a,b))},this)}}),Ext.define("Kanban.template.Task",{extend:"Ext.XTemplate",model:null,menuIconTpl:'<div class="sch-task-menu-handle"></div>',constructor:function(a){var b=this;Ext.apply(b,a);var c=b.model.prototype,d=c.idProperty,e=c.nameField;"string"!=typeof b.taskBodyTpl&&(b.taskBodyTpl='<tpl if="'+c.imageUrlField+'"><img class="sch-task-img" src="{taskImageUrl:htmlEncode}"/></tpl><span class="sch-task-id">{[ values.'+d+' ? "#" + values.'+d+' : "" ]}</span><span class="sch-task-name"> {'+e+":htmlEncode}</span>"),"string"!=typeof b.resourceImgTpl&&(b.resourceImgTpl='<img src="{resourceImageUrl:htmlEncode}" class="sch-user-avatar {resourceImageCls:htmlEncode}" />'),b.callParent(['<tpl for=".">','<div class="sch-task sch-task-state-{'+c.stateField+":htmlEncode} {"+c.clsField+':htmlEncode} {cls:htmlEncode}" style="{style}"><div class="sch-task-inner">'+b.taskBodyTpl+b.resourceImgTpl+(b.taskToolTpl||"")+"</div>"+b.menuIconTpl+"</div></tpl>"])}}),Ext.define("Kanban.selection.TaskModel",{extend:"Ext.mixin.Observable",panel:null,selModels:null,
constructor:function(a){var b=this;Ext.apply(b,a),b.callParent(arguments),b.selModels=Ext.Array.map(b.panel.views,function(a){return a.getSelectionModel()}),b.forEachView(function(a){b.mon(a,"containerclick",b.onEmptyAreaClick,b),b.relayEvents(a,["select","deselect"])})},select:function(a,b,c){a=[].concat(a);var d=!1,e=function(){d=!0};this.forEachSelModel(function(d){var f=Ext.Array.filter(a,function(a){return d.store.indexOf(a)>=0});d.on("selectionchange",e,null,{single:!0}),f.length>0?d.select(f,b,c):d.deselectAll(),d.un("selectionchange",e,null,{single:!0})}),d&&this.fireEvent("selectionchange",this.getSelection())},deselect:function(a,b){a=[].concat(a),this.forEachSelModel(function(c){var d=Ext.Array.filter(a,function(a){return c.store.indexOf(a)>=0});c.deselect(d,b)}),this.fireEvent("selectionchange",this.getSelection())},selectAll:function(){this.relayMethod("selectAll")},deselectAll:function(){this.relayMethod("deselectAll")},getSelection:function(){return this.relayMethod("getSelection")},getCount:function(){return Ext.Array.sum(this.relayMethod("getCount"))},deselectAllInOtherSelectionModels:function(a){this.forEachSelModel(function(b){b!==a&&b.deselectAll()})},relayMethod:function(a,b){return[].concat.apply([],Ext.Array.map(this.selModels,function(c){return c[a].apply(c,b||[])}))},forEachSelModel:function(a,b){Ext.Array.each(this.selModels,a,b||this)},onEmptyAreaClick:function(){this.deselectAll()},forEachView:function(a,b){Ext.Array.each(this.panel.views,a,b||this)},destroy:function(){}}),Ext.define("Kanban.view.TaskView",{extend:"Ext.view.View",alias:"widget.taskview",requires:["Kanban.template.Task","Kanban.data.ViewStore"],autoScroll:!0,trackOver:!0,overItemCls:"sch-task-over",selectedItemCls:"sch-task-selected",itemSelector:".sch-task",state:null,taskRenderer:function(a,b){},initComponent:function(){this.tpl=new Kanban.template.Task({model:this.store.model,resourceImgTpl:this.resourceImgTpl,taskToolTpl:this.taskToolTpl,taskBodyTpl:this.taskBodyTpl}),this.addCls("sch-taskview sch-taskview-state-"+this.state),this.callParent(arguments)},refresh:function(){var a=this.getEl(),b=a.down("."+Ext.baseCSSPrefix+"view-selector");b&&a.removeChild(b),this.callParent(arguments),b&&a.appendChild(b)},collectData:function(a){for(var b=this.callParent(arguments),c=[],d=0;d<b.length;d++){var e=Ext.apply({},b[d]),f=a[d],g=f.getResource(),h=g&&g.getImageUrl();e.resourceImageCls="",e.resourceImageUrl=h||Ext.BLANK_IMAGE_URL,e.taskImageUrl=f.getImageUrl(),e.task=f,e.name=f.getName(),h||(e.resourceImageCls="sch-no-img"),this.taskRenderer(f,e),f.phantom&&(e.cls=(e.cls||"")+" sch-phantom-task"),c.push(e)}return c}}),Ext.define("Kanban.view.TaskColumn",{extend:"Ext.Panel",alias:"widget.taskcolumn",requires:["Ext.layout.container.Fit","Kanban.view.TaskView"],iconCls:"sch-header-icon",flex:1,layout:"fit",collapseDirection:"right",state:null,store:null,taskBodyTpl:null,taskToolTpl:null,resourceImgTpl:null,origTitle:null,view:null,zoomLevel:"large",viewConfig:null,initComponent:function(){var a=this;if(null===a.state)throw"Must supply state";var b=Ext.apply({store:a.store,state:a.state},a.viewConfig||{});a.taskBodyTpl&&(b.taskBodyTpl=a.taskBodyTpl),a.taskToolTpl&&(b.taskToolTpl=a.taskToolTpl),a.resourceImgTpl&&(b.resourceImgTpl=a.resourceImgTpl),a.items=a.view=new Kanban.view.TaskView(b);var c=Sch.locale.Active["Kanban.locale"]||{};a.origTitle=a.title=a.title||c[a.state]||a.state,a.callParent(arguments),a.addCls("sch-taskcolumn sch-taskcolumn-state-"+a.state.replace(/\s/g,"-"))},onRender:function(){this.setZoomLevel(this.zoomLevel),this.header&&this.header.addCls("sch-taskcolumnheader-state-"+this.state.replace(/\s/g,"-")),this.callParent(arguments)},afterRender:function(){this.callParent(arguments),this.refreshTitle()},refreshTitle:function(){var a=this.state,b=this.store.query(this.store.getModel().prototype.stateField,a,!1,!1,!0).length;this.setTitle(this.origTitle+(b?" ("+b+")":""))},bindStore:function(a){var b={load:this.refreshTitle,datachanged:this.refreshTitle,update:this.refreshTitle,add:this.refreshTitle,remove:this.refreshTitle,buffer:20,scope:this};this.store&&this.mun(this.store,b),a&&(this.mon(a,b),this.view.bindStore(a)),this.store=a},getZoomLevel:function(){return this.zoomLevel},setZoomLevel:function(a){this.zoomLevel=a||"large",this.el.set({size:a})}}),Ext.define("Kanban.view.TaskBoard",{extend:"Ext.Panel",alias:"widget.taskboard",requires:["Kanban.locale.Ko","Kanban.data.TaskStore","Kanban.data.ResourceStore","Kanban.view.TaskColumn","Kanban.dd.DropZone","Kanban.dd.DragZone","Kanban.editor.SimpleEditor","Kanban.field.AddNew","Kanban.menu.UserMenu","Kanban.menu.TaskMenu","Kanban.selection.TaskModel"],border:!1,layout:{type:"hbox",align:"stretch"},defaultType:"taskcolumn",taskStore:null,resourceStore:null,columnClass:"Kanban.view.TaskColumn",columns:null,columnConfigs:null,editor:null,viewConfig:null,enableUserMenu:!0,readOnly:!1,userMenu:null,taskMenu:!0,dndValidatorFn:Ext.emptyFn,validatorFnScope:null,zoomLevel:"large",taskCls:"sch-task",taskSelector:".sch-task",isHighlighting:!1,views:null,kanbanColumns:null,selModel:null,initComponent:function(){var a=this;if(a.defaults=a.defaults||{},Ext.applyIf(a.defaults,{margin:12}),this.taskStore=Ext.data.StoreManager.lookup(this.taskStore),this.resourceStore=Ext.data.StoreManager.lookup(this.resourceStore),this.addCls("sch-taskboard"),this.addBodyCls("sch-taskboard-body"),this.on({add:this.onColumnsAdded,remove:this.onColumnsRemoved,scope:this}),this.columns?this.initColumns(this.columns):this.columns=this.createColumns(),this.items=this.columns,!this.taskStore)throw"Must define a taskStore for the Panel";if(!this.resourceStore)throw"Must define a resourceStore for the Panel";this.callParent(arguments),this.bindResourceStore(this.resourceStore,!0)},createColumns:function(){var a=this,b=a.taskStore.model.prototype.states,c=a.columnConfigs||{};return Ext.Array.map(b,function(b,d){return Ext.create(a.columnClass,Ext.apply({store:a.taskStore,state:b,viewConfig:a.viewConfig,zoomLevel:a.zoomLevel,taskBoard:a},Ext.apply(c[b]||{},c.all)))})},initColumns:function(a){var b=this;Ext.Array.forEach(a,function(a){a.items?b.initColumns(a.items):Ext.applyIf(a,{store:b.taskStore,viewConfig:b.viewConfig})},this)},onColumnsAdded:function(a,b){var c=b instanceof Kanban.view.TaskColumn?[b]:b.query("taskcolumn");Ext.Array.forEach(c,function(a){a.bindStore(new Kanban.data.ViewStore({masterStore:this.taskStore,state:a.state})),this.bindViewListeners(a.view),this.kanbanColumns&&this.kanbanColumns.push(a),this.views&&this.views.push(a.view)},this)},onColumnsRemoved:function(a,b){var c=b instanceof Kanban.view.TaskColumn&&b;Ext.Array.remove(this.kanbanColumns,c),Ext.Array.remove(this.views,c.view)},afterRender:function(){this.callParent(arguments),this.isReadOnly()||(this.setupDragDrop(),this.initEditor(),this.initTaskMenu(),this.enableUserMenu&&this.userMenu&&this.initUserMenu()),this.views=this.query("taskview"),this.kanbanColumns=this.query("taskcolumn"),this.on("taskclick",this.onTaskClick,this)},setReadOnly:function(a){this.readOnly=a},isReadOnly:function(){return this.readOnly},bindViewListeners:function(a){a.on({itemclick:this.getTaskListener("taskclick"),itemcontextmenu:this.getTaskListener("taskcontextmenu"),itemdblclick:this.getTaskListener("taskdblclick"),itemmouseenter:this.getTaskListener("taskmouseenter"),itemmouseleave:this.getTaskListener("taskmouseleave"),itemkeydown:this.getTaskListener("taskkeydown"),itemkeyup:this.getTaskListener("taskkeyup"),scope:this})},setupDragDrop:function(){this.dragZone=new Kanban.dd.DragZone(this.id,{panel:this}),this.dropZone=new Kanban.dd.DropZone(this.id,{panel:this,validatorFn:this.dndValidatorFn,validatorFnScope:this.validatorFnScope}),this.relayEvents(this.dragZone,["beforetaskdrag","taskdragstart","aftertaskdrop"]),this.relayEvents(this.dropZone,["beforetaskdropfinalize","taskdrop","aftertaskdrop"]),this.dropZone.on("aftertaskdrop",this.onAfterTaskDrop,this),this.dragZone.on("taskdragstarting",this.onDragStarting,this)},resolveState:function(a){if(Ext.isIE&&!a&&(a=document.body),!a.dom){var b=Ext.fly(a);if(b.is(".sch-taskview")||(b=b.up(".sch-taskview")),b&&b.component)return b.component.state}return!1},setZoomLevel:function(a){this.translateToColumns("setZoomLevel",[a])},getZoomLevel:function(){return this.down("taskcolumn").getZoomLevel()},initEditor:function(){this.editor&&(this.editor.isComponent||(this.editor=Ext.widget(this.editor)),this.editor.init(this))},initUserMenu:function(){this.userMenu instanceof Ext.Component||(this.userMenu=Ext.ComponentManager.create(this.userMenu)),this.el.on({click:this.onUserImgClick,delegate:".sch-user-avatar",scope:this})},initTaskMenu:function(){if(this.taskMenu){var a="boolean"==typeof this.taskMenu?{xtype:"kanban_taskmenu"}:this.taskMenu;Ext.isArray(a)&&(a={items:a}),a.taskBoard=this,a.isTaskMenu||(this.taskMenu=Ext.widget(Ext.applyIf(a,{xtype:"kanban_taskmenu"}))),this.taskMenu.registerListeners(),this.addCls("sch-taskboard-with-menu")}},onUserImgClick:function(a,b){a.stopEvent(),this.isReadOnly()||this.userMenu.showForTask(this.resolveRecordByNode(b),a.getXY())},resolveViewByNode:function(a){var b=Ext.fly(a).up(".sch-taskview");return b&&Ext.getCmp(b.id)||null},resolveRecordByNode:function(a){var b=this.resolveViewByNode(a);return b&&b.getRecord(b.findItemByChild(a))||null},onTaskClick:function(a,b,c,d){d.ctrlKey||this.deselectAllInOtherViews(a)},deselectAllInOtherViews:function(a){this.getSelectionModel().deselectAllInOtherSelectionModels(a.getSelectionModel())},getElementForTask:function(a){a instanceof Ext.data.Model||(a=this.taskStore.getById(a));var b=a.getState();if(b)return Ext.get(this.getViewForState(b).getNode(a))},getViewForState:function(a){return this.down("taskview[state="+[a]+"]")},forEachColumn:function(a,b){Ext.Array.each(this.query("taskcolumn"),a,b||this)},translateToViews:function(a,b){null!=this.views&&Ext.Array.map(this.views,function(c){return c[a].apply(c,b||[])})},translateToColumns:function(a,b){Ext.Array.map(this.kanbanColumns,function(c){return c[a].apply(c,b||[])})},translateToSelectionModels:function(a,b){Ext.Array.map(this.views,function(c){var d=c.getSelectionModel();d[a].apply(d,b||[])})},getSelectedRecords:function(){return[].concat.apply([],Ext.Array.map(this.views,function(a){return a.getSelectionModel().getSelection()}))},selectAll:function(){this.getSelectionModel().selectAll()},deselectAll:function(){this.getSelectionModel().deselectAll()},onDestroy:function(){Ext.destroy(this.dragZone,this.dropZone,this.userMenu,this.taskMenu)},getTaskListener:function(a){return function(b,c,d,e,f){this.fireEvent(a,b,c,d,f)}},highlightTasksBy:function(a,b){this.isHighlighting||(this.el.addCls("sch-taskboard-filtered"),this.isHighlighting=!0),this.el.select(".sch-filter-match").removeCls("sch-filter-match");for(var c=0,d=this.taskStore.getCount();c<d;c++){var e=this.taskStore.getAt(c);if(a.call(b||this,e)){var f=this.getElementForTask(e);f&&f.addCls("sch-filter-match")}}},clearHighlight:function(){this.isHighlighting=!1,this.el.removeCls("sch-taskboard-filtered"),this.el.select(".sch-filter-match").removeCls("sch-filter-match")},refresh:function(){try{this.translateToViews("refresh")}catch(a){console.log("kanban refresh e",a)}this.fireEvent("refresh",this)},refreshTaskNode:function(a){var b=this.getElementForTask(a);if(b){var c=this.resolveViewByNode(b);c.refreshNode(a)}},bindResourceStore:function(a,b){var c={update:this.onResourceStoreUpdate,refresh:this.onResourceStoreRefresh,remove:this.onResourceStoreRemove,scope:this};this.resourceStore&&this.mun(this.resourceStore,c),a&&(a=Ext.data.StoreManager.lookup(a),this.mon(a,c),this.taskStore.setResourceStore(a),b||this.refresh()),this.resourceStore=a},onResourceStoreUpdate:function(){this.refresh()},onResourceStoreRefresh:function(){this.refresh()},onResourceStoreRemove:function(){this.refresh()},onDragStarting:function(a,b,c){c.ctrlKey||this.deselectAllInOtherViews(this.getViewForState(b.getState()))},onAfterTaskDrop:function(){this.getSelectionModel().deselectAll()},getTaskMenu:function(){return this.taskMenu},getTaskStore:function(){return this.taskStore},getResourceStore:function(){return this.resourceStore},getTaskEditor:function(){return this.editor},getSelectionModel:function(){return this.selModel||(this.selModel=this.createSelectionModel()),this.selModel},createSelectionModel:function(){var a=new Kanban.selection.TaskModel({panel:this});return this.relayEvents(a,["deselect","select"]),a}},function(){Ext.apply(Kanban,{VERSION:"2.0.9"})});