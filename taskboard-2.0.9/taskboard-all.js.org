/*

Kanban TaskBoard 2.0.9
Copyright(c) 2009-2016 Bryntum AB
http://bryntum.com/contact
http://bryntum.com/license

*/
Ext.define("Sch.util.Patch",{target:null,minVersion:null,maxVersion:null,reportUrl:null,description:null,applyFn:null,ieOnly:false,macOnly:false,overrides:null,onClassExtended:function(a,b){if(Sch.disableOverrides){return}if(b.ieOnly&&!Ext.isIE){return}if(b.macOnly&&!Ext.isMac){return}if((!b.minVersion||Ext.versions.extjs.equals(b.minVersion)||Ext.versions.extjs.isGreaterThan(b.minVersion))&&(!b.maxVersion||Ext.versions.extjs.equals(b.maxVersion)||Ext.versions.extjs.isLessThan(b.maxVersion))){if(b.applyFn){b.applyFn()}else{Ext.ClassManager.get(b.target).override(b.overrides)}}}});Ext.define("Sch.patches.Collection",{extend:"Sch.util.Patch",requires:["Ext.util.Collection"],target:"Ext.util.Collection",minVersion:"5.1.0",overrides:{updateKey:function(b,e){var a=this,d=a.map,g=a.indices,c=a.getSource(),f;if(c&&!c.updating){c.updateKey(b,e)}else{if(d[e]&&(f=a.getKey(b))!==e){if(e in d||d[f]!==b){if(e in d){delete d[e]}a.updating++;a.generation++;d[f]=b;if(g){g[f]=g[e];delete g[e]}a.notify("updatekey",[{item:b,newKey:f,oldKey:e}]);a.updating--}}}}}});Ext.define("Sch.patches.OperationDestroy",{extend:"Sch.util.Patch",requires:["Ext.data.operation.Destroy"],target:"Ext.data.operation.Destroy",minVersion:"5.1.1",maxVersion:"5.1.2",overrides:{doProcess:function(){var c=Ext.Array.slice(this.getRecords()),a=c.length,b;for(b=0;b<a;++b){c[b].setErased()}}}});Ext.define("Sch.patches.View",{extend:"Sch.util.Patch",requires:["Ext.view.View"],target:"Ext.view.View",minVersion:"5.1.0",overrides:{handleEvent:function(d){var c=this,b=c.keyEventRe.test(d.type),a=c.getNavigationModel();d.view=c;if(b){d.item=a.getItem();d.record=a.getRecord()}if(!d.item){d.item=d.getTarget(c.itemSelector)}if(d.item&&!d.record){d.record=c.getRecord(d.item)}if(c.processUIEvent(d)!==false){c.processSpecialEvent(d)}if(b&&!Ext.fly(d.target).isInputField()){if(d.getKey()===d.SPACE||d.isNavKeyPress(true)){d.preventDefault()}}}}});Ext.define("Sch.locale.Locale",{l10n:null,legacyMode:true,localeName:null,namespaceId:null,constructor:function(){if(!Sch.locale.Active){Sch.locale.Active={};this.bindRequire()}var b=this.self.getName().split(".");var a=this.localeName=b.pop();this.namespaceId=b.join(".");var c=Sch.locale.Active[this.namespaceId];if(!(a=="En"&&c&&c.localeName!="En")){this.apply()}},bindRequire:function(){var a=Ext.ClassManager.triggerCreated;Ext.ClassManager.triggerCreated=function(d){a.apply(this,arguments);if(d){var c=Ext.ClassManager.get(d);for(var b in Sch.locale.Active){Sch.locale.Active[b].apply(c)}}}},applyToClass:function(c,b){var d=this,g=d.self.getName();b=b||Ext.ClassManager.get(c);if(b&&(b.activeLocaleId!==g)){var a=d.l10n[c];if(typeof a==="function"){a(c)}else{if(b.singleton){b.l10n=Ext.apply({},a,b.prototype&&b.prototype.l10n)}else{Ext.override(b,{l10n:a})}}if(d.legacyMode){var f;if(b.prototype){f=b.prototype}else{if(b.singleton){f=b}}if(f&&f.legacyMode){if(f.legacyHolderProp){if(!f[f.legacyHolderProp]){f[f.legacyHolderProp]={}}f=f[f.legacyHolderProp]}for(var e in a){if(typeof f[e]!=="function"){f[e]=a[e]}}}}b.activeLocaleId=g;if(b.onLocalized){b.onLocalized()}}},apply:function(g){if(this.l10n){var f=this;if(g){if(!Ext.isArray(g)){g=[g]}var c,b;for(var d=0,a=g.length;d<a;d++){if(Ext.isObject(g[d])){if(g[d].singleton){b=g[d];c=Ext.getClassName(Ext.getClass(b))}else{b=Ext.getClass(g[d]);c=Ext.getClassName(b)}}else{b=null;c="string"===typeof g[d]?g[d]:Ext.getClassName(g[d])}if(c){if(c in this.l10n){f.applyToClass(c,b)}}}}else{Sch.locale.Active[this.namespaceId]=this;for(var e in this.l10n){f.applyToClass(e)}}}}});Ext.define("Sch.locale.En",{extend:"Sch.locale.Locale",singleton:true,constructor:function(a){Ext.apply(this,{l10n:{"Sch.util.Date":{unitNames:{YEAR:{single:"year",plural:"years",abbrev:"yr"},QUARTER:{single:"quarter",plural:"quarters",abbrev:"q"},MONTH:{single:"month",plural:"months",abbrev:"mon"},WEEK:{single:"week",plural:"weeks",abbrev:"w"},DAY:{single:"day",plural:"days",abbrev:"d"},HOUR:{single:"hour",plural:"hours",abbrev:"h"},MINUTE:{single:"minute",plural:"minutes",abbrev:"min"},SECOND:{single:"second",plural:"seconds",abbrev:"s"},MILLI:{single:"ms",plural:"ms",abbrev:"ms"}}},"Sch.panel.TimelineGridPanel":{weekStartDay:1,loadingText:"Loading, please wait...",savingText:"Saving changes, please wait..."},"Sch.panel.TimelineTreePanel":{weekStartDay:1,loadingText:"Loading, please wait...",savingText:"Saving changes, please wait..."},"Sch.mixin.SchedulerView":{loadingText:"Loading events..."},"Sch.plugin.CurrentTimeLine":{tooltipText:"Current time"},"Sch.plugin.EventEditor":{saveText:"Save",deleteText:"Delete",cancelText:"Cancel"},"Sch.plugin.SimpleEditor":{newEventText:"New booking..."},"Sch.widget.ExportDialogForm":{formatFieldLabel:"Paper format",orientationFieldLabel:"Orientation",rangeFieldLabel:"Schedule range",showHeaderLabel:"Add page number",showFooterLabel:"Add footer",orientationPortraitText:"Portrait",orientationLandscapeText:"Landscape",completeViewText:"Complete schedule",currentViewText:"Visible schedule",dateRangeText:"Date range",dateRangeFromText:"Export from",dateRangeToText:"Export to",exportersFieldLabel:"Control pagination",adjustCols:"Adjust column width",adjustColsAndRows:"Adjust column width and row height",specifyDateRange:"Specify date range",columnPickerLabel:"Select columns",completeDataText:"Complete schedule (for all events)",dpiFieldLabel:"DPI (dots per inch)",rowsRangeLabel:"Rows range",allRowsLabel:"All rows",visibleRowsLabel:"Visible rows"},"Sch.widget.ExportDialog":{title:"Export Settings",exportButtonText:"Export",cancelButtonText:"Cancel",progressBarText:"Exporting..."},"Sch.plugin.Export":{generalError:"An error occurred",fetchingRows:"Fetching row {0} of {1}",builtPage:"Built page {0} of {1}",requestingPrintServer:"Please wait..."},"Sch.plugin.Printable":{dialogTitle:"Print settings",exportButtonText:"Print"},"Sch.plugin.exporter.AbstractExporter":{name:"Exporter"},"Sch.plugin.exporter.SinglePage":{name:"Single page"},"Sch.plugin.exporter.MultiPageVertical":{name:"Multiple pages (vertically)"},"Sch.plugin.exporter.MultiPage":{name:"Multiple pages"},"Sch.preset.Manager":{hourAndDay:{displayDateFormat:"G:i",middleDateFormat:"G:i",topDateFormat:"D d/m"},secondAndMinute:{displayDateFormat:"g:i:s",topDateFormat:"D, d g:iA"},dayAndWeek:{displayDateFormat:"m/d h:i A",middleDateFormat:"D d M"},weekAndDay:{displayDateFormat:"m/d",bottomDateFormat:"d M",middleDateFormat:"Y F d"},weekAndMonth:{displayDateFormat:"m/d/Y",middleDateFormat:"m/d",topDateFormat:"m/d/Y"},weekAndDayLetter:{displayDateFormat:"m/d/Y",middleDateFormat:"D d M Y"},weekDateAndMonth:{displayDateFormat:"m/d/Y",middleDateFormat:"d",topDateFormat:"Y F"},monthAndYear:{displayDateFormat:"m/d/Y",middleDateFormat:"M Y",topDateFormat:"Y"},year:{displayDateFormat:"m/d/Y",middleDateFormat:"Y"},manyYears:{displayDateFormat:"m/d/Y",middleDateFormat:"Y"}}}});this.callParent(arguments)}});Ext.define("Sch.mixin.Localizable",{requires:["Sch.locale.En"],legacyMode:false,activeLocaleId:"",l10n:null,isLocaleApplied:function(){var b=(this.singleton&&this.activeLocaleId)||this.self.activeLocaleId;if(!b){return false}for(var a in Sch.locale.Active){if(b===Sch.locale.Active[a].self.getName()){return true}}return false},applyLocale:function(){for(var a in Sch.locale.Active){Sch.locale.Active[a].apply(this.singleton?this:this.self.getName())}},L:function(){return this.localize.apply(this,arguments)},localize:function(b,d,g){if(!this.isLocaleApplied()&&!g){this.applyLocale()}if(this.hasOwnProperty("l10n")&&this.l10n.hasOwnProperty(b)&&"function"!=typeof this.l10n[b]){return this.l10n[b]}var c=this.self&&this.self.prototype;if(this.legacyMode){var a=d||this.legacyHolderProp;var h=a?this[a]:this;if(h&&h.hasOwnProperty(b)&&"function"!=typeof h[b]){return h[b]}if(c){var e=a?c[a]:c;if(e&&e.hasOwnProperty(b)&&"function"!=typeof e[b]){return e[b]}}}var i=c.l10n&&c.l10n[b];if(i===null||i===undefined){var f=c&&c.superclass;if(f&&f.localize){i=f.localize(b,d,g)}if(i===null||i===undefined){throw"Cannot find locale: "+b+" ["+this.self.getName()+"]"}}return i}});Ext.define("Sch.util.Date",{requires:"Ext.Date",mixins:["Sch.mixin.Localizable"],singleton:true,stripEscapeRe:/(\\.)/g,hourInfoRe:/([gGhHisucUOPZ]|MS)/,unitHash:null,unitsByName:{},constructor:function(){var a=Ext.Date;var c=this.unitHash={MILLI:a.MILLI,SECOND:a.SECOND,MINUTE:a.MINUTE,HOUR:a.HOUR,DAY:a.DAY,WEEK:"w",MONTH:a.MONTH,QUARTER:"q",YEAR:a.YEAR};Ext.apply(this,c);var b=this;this.units=[b.MILLI,b.SECOND,b.MINUTE,b.HOUR,b.DAY,b.WEEK,b.MONTH,b.QUARTER,b.YEAR]},onLocalized:function(){this.setUnitNames(this.L("unitNames"))},setUnitNames:function(e){var d=this.unitsByName={};this.l10n.unitNames=e;this._unitNames=Ext.apply({},e);var b=this.unitHash;for(var a in b){if(b.hasOwnProperty(a)){var c=b[a];this._unitNames[c]=this._unitNames[a];d[a]=c;d[c]=c}}},betweenLesser:function(b,d,a){var c=b.getTime();return d.getTime()<=c&&c<a.getTime()},constrain:function(b,c,a){return this.min(this.max(b,c),a)},compareUnits:function(c,b){var a=Ext.Array.indexOf(this.units,c),d=Ext.Array.indexOf(this.units,b);return a>d?1:(a<d?-1:0)},isUnitGreater:function(b,a){return this.compareUnits(b,a)>0},copyTimeValues:function(b,a){b.setHours(a.getHours());b.setMinutes(a.getMinutes());b.setSeconds(a.getSeconds());b.setMilliseconds(a.getMilliseconds())},add:function(b,c,e){var f=Ext.Date.clone(b);if(!c||e===0){return f}switch(c.toLowerCase()){case this.MILLI:f=new Date(b.getTime()+e);break;case this.SECOND:f=new Date(b.getTime()+(e*1000));break;case this.MINUTE:f=new Date(b.getTime()+(e*60000));break;case this.HOUR:f=new Date(b.getTime()+(e*3600000));break;case this.DAY:f.setDate(b.getDate()+e);if(f.getHours()===23&&b.getHours()===0){f=Ext.Date.add(f,Ext.Date.HOUR,1)}break;case this.WEEK:f.setDate(b.getDate()+e*7);break;case this.MONTH:var a=b.getDate();if(a>28){a=Math.min(a,Ext.Date.getLastDateOfMonth(this.add(Ext.Date.getFirstDateOfMonth(b),this.MONTH,e)).getDate())}f.setDate(a);f.setMonth(f.getMonth()+e);break;case this.QUARTER:f=this.add(b,this.MONTH,e*3);break;case this.YEAR:f.setFullYear(b.getFullYear()+e);break}return f},getUnitDurationInMs:function(a){return this.add(new Date(1,0,1),a,1)-new Date(1,0,1)},getMeasuringUnit:function(a){if(a===this.WEEK){return this.DAY}return a},getDurationInUnit:function(e,a,c,d){var b;switch(c){case this.YEAR:b=this.getDurationInYears(e,a);break;case this.QUARTER:b=this.getDurationInMonths(e,a)/3;break;case this.MONTH:b=this.getDurationInMonths(e,a);break;case this.WEEK:b=this.getDurationInDays(e,a)/7;break;case this.DAY:b=this.getDurationInDays(e,a);break;case this.HOUR:b=this.getDurationInHours(e,a);break;case this.MINUTE:b=this.getDurationInMinutes(e,a);break;case this.SECOND:b=this.getDurationInSeconds(e,a);break;case this.MILLI:b=this.getDurationInMilliseconds(e,a);break}return d?b:Math.round(b)},getUnitToBaseUnitRatio:function(b,a){if(b===a){return 1}switch(b){case this.YEAR:switch(a){case this.QUARTER:return 1/4;case this.MONTH:return 1/12}break;case this.QUARTER:switch(a){case this.YEAR:return 4;case this.MONTH:return 1/3}break;case this.MONTH:switch(a){case this.YEAR:return 12;case this.QUARTER:return 3}break;case this.WEEK:switch(a){case this.DAY:return 1/7;case this.HOUR:return 1/168}break;case this.DAY:switch(a){case this.WEEK:return 7;case this.HOUR:return 1/24;case this.MINUTE:return 1/1440}break;case this.HOUR:switch(a){case this.DAY:return 24;case this.MINUTE:return 1/60}break;case this.MINUTE:switch(a){case this.HOUR:return 60;case this.SECOND:return 1/60;case this.MILLI:return 1/60000}break;case this.SECOND:switch(a){case this.MILLI:return 1/1000}break;case this.MILLI:switch(a){case this.SECOND:return 1000}break}return -1},getDurationInMilliseconds:function(b,a){return(a-b)},getDurationInSeconds:function(b,a){return(a-b)/1000},getDurationInMinutes:function(b,a){return(a-b)/60000},getDurationInHours:function(b,a){return(a-b)/3600000},getDurationInDays:function(c,b){var a=c.getTimezoneOffset()-b.getTimezoneOffset();return(b-c+a*60*1000)/86400000},getDurationInMonths:function(b,a){return((a.getFullYear()-b.getFullYear())*12)+(a.getMonth()-b.getMonth())},getDurationInYears:function(b,a){return this.getDurationInMonths(b,a)/12},min:function(b,a){return b<a?b:a},max:function(b,a){return b>a?b:a},intersectSpans:function(c,d,b,a){return this.betweenLesser(c,b,a)||this.betweenLesser(b,c,d)},getNameOfUnit:function(a){a=this.getUnitByName(a);switch(a.toLowerCase()){case this.YEAR:return"YEAR";case this.QUARTER:return"QUARTER";case this.MONTH:return"MONTH";case this.WEEK:return"WEEK";case this.DAY:return"DAY";case this.HOUR:return"HOUR";case this.MINUTE:return"MINUTE";case this.SECOND:return"SECOND";case this.MILLI:return"MILLI"}throw"Incorrect UnitName"},getReadableNameOfUnit:function(b,a){if(!this.isLocaleApplied()){this.applyLocale()}return this._unitNames[b][a?"plural":"single"]},getShortNameOfUnit:function(a){if(!this.isLocaleApplied()){this.applyLocale()}return this._unitNames[a].abbrev},getUnitByName:function(a){if(!this.isLocaleApplied()){this.applyLocale()}if(!this.unitsByName[a]){Ext.Error.raise("Unknown unit name: "+a)}return this.unitsByName[a]},getNext:function(c,g,a,f){var e=Ext.Date.clone(c);f=arguments.length<4?1:f;a=a==null?1:a;switch(g){case this.MILLI:e=this.add(c,g,a);break;case this.SECOND:e=this.add(c,g,a);if(e.getMilliseconds()>0){e.setMilliseconds(0)}break;case this.MINUTE:e=this.add(c,g,a);if(e.getSeconds()>0){e.setSeconds(0)}if(e.getMilliseconds()>0){e.setMilliseconds(0)}break;case this.HOUR:e=this.add(c,g,a);if(e.getMinutes()>0){e.setMinutes(0)}if(e.getSeconds()>0){e.setSeconds(0)}if(e.getMilliseconds()>0){e.setMilliseconds(0)}break;case this.DAY:var d=c.getHours()===23&&this.add(e,this.HOUR,1).getHours()===1;if(d){e=this.add(e,this.DAY,2);this.clearTime(e);return e}this.clearTime(e);e=this.add(e,this.DAY,a);if(e.getHours()===1){this.clearTime(e)}break;case this.WEEK:this.clearTime(e);var b=e.getDay();e=this.add(e,this.DAY,f-b+7*(a-(f<=b?0:1)));if(e.getDay()!==f){e=this.add(e,this.HOUR,1)}else{this.clearTime(e)}break;case this.MONTH:e=this.add(e,this.MONTH,a);e.setDate(1);this.clearTime(e);break;case this.QUARTER:e=this.add(e,this.MONTH,((a-1)*3)+(3-(e.getMonth()%3)));this.clearTime(e);e.setDate(1);break;case this.YEAR:e=new Date(e.getFullYear()+a,0,1);break;default:throw"Invalid date unit"}return e},getNumberOfMsFromTheStartOfDay:function(a){return a-this.clearTime(a,true)||86400000},getNumberOfMsTillTheEndOfDay:function(a){return this.getStartOfNextDay(a,true)-a},getStartOfNextDay:function(b,f,e){var d=this.add(e?b:this.clearTime(b,f),this.DAY,1);if(d.getDate()==b.getDate()){var c=this.add(this.clearTime(b,f),this.DAY,2).getTimezoneOffset();var a=b.getTimezoneOffset();d=this.add(d,this.MINUTE,a-c)}return d},getEndOfPreviousDay:function(b,c){var a=c?b:this.clearTime(b,true);if(a-b){return a}else{return this.add(a,this.DAY,-1)}},timeSpanContains:function(c,b,d,a){return(d-c)>=0&&(b-a)>=0},compareWithPrecision:function(e,c,f){var d=Sch.util.Date,b=Ext.Date,a;switch(f){case d.DAY:e=Number(b.format(e,"Ymd"));c=Number(b.format(c,"Ymd"));break;case d.WEEK:e=Number(b.format(e,"YmW"));c=Number(b.format(c,"YmW"));break;case d.MONTH:e=Number(b.format(e,"Ym"));c=Number(b.format(c,"Ym"));break;case d.QUARTER:e=e.getFullYear()*4+Math.floor(e.getMonth()/3);c=c.getFullYear()*4+Math.floor(c.getMonth()/3);break;case d.YEAR:e=e.getFullYear();c=c.getFullYear();break;default:case d.MILLI:case d.SECOND:case d.MINUTE:case d.HOUR:f=f&&this.getUnitDurationInMs(f)||1;e=Math.floor(e.valueOf()/f);c=Math.floor(c.valueOf()/f);break}((e<c)&&(a=-1))||((e>c)&&(a=+1))||(a=0);return a},getValueInUnits:function(a,b){switch(b){case this.MONTH:return a.getMonth();case this.DAY:return a.getDate();case this.HOUR:return a.getHours();case this.MINUTE:return a.getMinutes();case this.SECOND:return a.getSeconds()}},setValueInUnits:function(b,c,e){var a=Ext.Date.clone(b),d;switch(c){case this.YEAR:d="setFullYear";break;case this.MONTH:d="setMonth";break;case this.DAY:d="setDate";break;case this.HOUR:d="setHours";break;case this.MINUTE:d="setMinutes";break;case this.SECOND:d="setSeconds";break;case this.MILLI:d="setMilliseconds";break}a[d](e);return a},getSubUnit:function(a){switch(a){case this.YEAR:return this.MONTH;case this.MONTH:return this.DAY;case this.DAY:return this.HOUR;case this.HOUR:return this.MINUTE;case this.MINUTE:return this.SECOND;case this.SECOND:return this.MILLI}},setValueInSubUnits:function(a,b,c){b=this.getSubUnit(b);return this.setValueInUnits(a,b,c)},mergeDates:function(c,b,a){var d=Ext.Date.clone(c);switch(a){case this.YEAR:d.setFullYear(b.getFullYear());case this.MONTH:d.setMonth(b.getMonth());case this.WEEK:case this.DAY:if(a===this.WEEK){d=this.add(d,this.DAY,b.getDay()-d.getDay())}else{d.setDate(b.getDate())}case this.HOUR:d.setHours(b.getHours());case this.MINUTE:d.setMinutes(b.getMinutes());case this.SECOND:d.setSeconds(b.getSeconds());case this.MILLI:d.setMilliseconds(b.getMilliseconds())}return d},splitToSubUnits:function(d,c,a,b){a=a||1;b=arguments.length<4?1:b;switch(c){case this.MONTH:return this.splitMonth(d,a,b);case this.WEEK:case this.DAY:return this.splitDay(d,a);default:break}},splitYear:function(e,c){var b=this.clearTime(e,true);b.setMonth(0);b.setDate(1);var a=[];for(var d=0;d<=12;d=d+c){a.push(this.add(b,this.MONTH,d))}return a},splitMonth:function(h,c,g){var b=this.clearTime(h,true);b.setDate(1);b=this.add(b,this.DAY,g-b.getDay());var d=Ext.Date.clone(b);var f=this.add(b,this.MONTH,1);var a=[];for(var e=0;d.getTime()<f.getTime();e=e+c){d=this.add(b,this.WEEK,e);a.push(d)}return a},splitWeek:function(f,c,e){var b=this.add(f,this.DAY,e-f.getDay());b=this.clearTime(b);var a=[];for(var d=0;d<=7;d=d+c){a.push(this.add(b,this.DAY,d))}return a},splitDay:function(e,b){var d=this.clearTime(e,true);var a=[];for(var c=0;c<=24;c=c+b){a.push(this.add(d,this.HOUR,c))}return a},splitHour:function(e,b){var d=new Date(e.getTime());d.setMinutes(0);d.setSeconds(0);d.setMilliseconds(0);var a=[];for(var c=0;c<=60;c=c+b){a.push(this.add(d,this.MINUTE,c))}return a},splitMinute:function(e,b){var d=Ext.Date.clone(e);d.setSeconds(0);d.setMilliseconds(0);var a=[];for(var c=0;c<=60;c=c+b){a.push(this.add(d,this.SECOND,c))}return a},clearTime:function(a,b){if(a.getHours()>0||a.getMinutes()>0||a.getSeconds()>0){return Ext.Date.clearTime(a,b)}return b?Ext.Date.clone(a):a}});Ext.define("Sch.util.Cache",{cache:null,constructor:function(){this.cache={}},key:function(b){var a;if(b instanceof Ext.data.Model){a=b.getId().toString()}else{if(b===undefined||b===null){a="[ undefined / null ]"}else{a=(b).toString()}}return a},get:function(b,c){var d=this,a;b=d.key(b);a=d.cache.hasOwnProperty(b)&&d.cache[b];if(!a&&c){a=c()}else{if(!a){a=[]}}d.cache[b]=a;return a},add:function(c,b){var d=this,a=d.key(c);if(!d.cache.hasOwnProperty(a)){d.cache[a]=d.get(c)}Ext.Array.include(d.cache[a],b);return d},remove:function(b,a){var c=this;b=c.key(b);if(c.cache.hasOwnProperty(b)){Ext.Array.remove(c.cache[b],a)}return c},move:function(c,d,a){var b=this;c=b.key(c);d=b.key(d);if(c!=d&&arguments.length>=3){b.remove(c,a);b.add(d,a)}else{if(c!=d&&b.cache.hasOwnProperty(c)&&b.cache.hasOwnProperty(d)){b.cache[d]=Ext.Array.union(b.cache[d],b.cache[c]);b.cache[c]=[]}else{if(c!=d&&b.cache.hasOwnProperty(c)){b.cache[d]=b.cache[c];b.cache[c]=[]}}}},clear:function(a){var b=this;if(!arguments.length){b.cache={}}else{a=b.key(a);if(b.cache.hasOwnProperty(a)){delete b.cache[a]}}return b},uncache:function(b){var c=this,a;for(a in c.cache){if(c.cache.hasOwnProperty(a)){c.cache[a]=Ext.Array.remove(c.cache[a],b)}}return c}});if(!Ext.ClassManager.get("Sch.model.Customizable")){Ext.define("Sch.model.Customizable",{extend:"Ext.data.Model",customizableFields:null,previous:null,__editing:null,__editCounter:0,constructor:function(){var a=this.callParent(arguments);return a},onClassExtended:function(b,d,a){var c=a.onBeforeCreated;a.onBeforeCreated=function(n,i){c.apply(this,arguments);var j=n.prototype;if(!j.customizableFields){return}j.customizableFields=(n.superclass.customizableFields||[]).concat(j.customizableFields);var g=j.customizableFields;var h={};var l=this;var f=Ext.Array.findBy(n.fields,function(o){return o.name===j.idProperty});l.idField=j.idField=f;if(!n.fieldsMap[j.idProperty]){n.fieldsMap[j.idProperty]=f}Ext.Array.forEach(g,function(o){if(typeof o=="string"){o={name:o}}h[o.name]=o});var k=j.fields;var m=[];var e=[];Ext.Array.forEach(k,function(o){if(o.isCustomizableField){e.push(o.getName())}});if(j.idProperty!=="id"&&j.getField("id")){if(!j.getField("id").hasOwnProperty("name")){e.push("id")}}if(j.idProperty!=="Id"&&j.getField("Id")){if(!j.getField("Id").hasOwnProperty("name")){e.push("Id")}}n.removeFields(e);Ext.Object.each(h,function(o,r){r.isCustomizableField=true;var s=r.name||r.getName();var x=s==="Id"?"idProperty":s.charAt(0).toLowerCase()+s.substr(1)+"Field";var t=j[x];var w=t||s;var v;if(j.getField(w)){v=Ext.applyIf({name:s,isCustomizableField:true},j.getField(w));j.getField(w).isCustomizableField=true;v=Ext.create("data.field."+(v.type||"auto"),v);g.push(v)}else{v=Ext.applyIf({name:w,isCustomizableField:true},r);v=Ext.create("data.field."+(v.type||"auto"),v);m.push(v)}var q=Ext.String.capitalize(s);if(q!="Id"){var u="get"+q;var p="set"+q;if(!j[u]||j[u].__getterFor__&&j[u].__getterFor__!=w){j[u]=function(){return this.get(this[x]||w)};j[u].__getterFor__=w}if(!j[p]||j[p].__setterFor__&&j[p].__setterFor__!=w){j[p]=function(y){return this.set(this[x]||w,y)};j[p].__setterFor__=w}}});n.addFields(m)}},set:function(f,b){var a;var d;this.previous=this.previous||{};if(typeof f==="string"){a=this.get(f);if(a instanceof Date&&!(b instanceof Date)){b=this.getField(f).convert(b,this)}if((a instanceof Date&&(a-b))||!(a instanceof Date)&&a!==b){this.previous[f]=a}else{return[]}}else{for(var e in f){a=this.get(e);var c=f[e];if(a instanceof Date&&!(c instanceof Date)){c=this.getField(e).convert(c,this)}if((a instanceof Date&&(a-c))||!(a instanceof Date)&&a!==c){this.previous[e]=a}}}d=this.callParent(arguments);if(!this.__editing){delete this.previous}return d},reject:function(){var b=this,a=b.modified||{},c;b.__editing=true;b.previous=b.previous||{};for(c in a){if(a.hasOwnProperty(c)){if(typeof a[c]!="function"){b.previous[c]=b.get(c)}}}b.callParent(arguments);delete b.previous;b.__editing=false},beginEdit:function(){this.__editCounter++;this.__editing=true;this.callParent(arguments)},cancelEdit:function(){this.__editCounter=0;this.__editing=false;this.callParent(arguments);delete this.previous},endEdit:function(b,c){if(--this.__editCounter===0){if(!b&&this.getModifiedFieldNames){var a=this.editMemento;if(!c){c=this.getModifiedFieldNames(a.data)}if(c&&c.length===0){b=true}}this.callParent([b].concat(Array.prototype.slice.call(arguments,1)));this.__editing=false;delete this.previous}}})}if(!Ext.ClassManager.get("Sch.model.Range")){Ext.define("Sch.model.Range",{extend:"Sch.model.Customizable",requires:["Sch.util.Date"],idProperty:"Id",config:Ext.versions.touch?{idProperty:"Id"}:null,startDateField:"StartDate",endDateField:"EndDate",nameField:"Name",clsField:"Cls",customizableFields:[{name:"StartDate",type:"date",dateFormat:"c"},{name:"EndDate",type:"date",dateFormat:"c"},{name:"Cls",type:"string"},{name:"Name",type:"string"}],setStartDate:function(a,d){var c=this.getEndDate();var b=this.getStartDate();this.set(this.startDateField,a);if(d===true&&c&&b){this.setEndDate(Sch.util.Date.add(a,Sch.util.Date.MILLI,c-b))}},setEndDate:function(b,d){var a=this.getStartDate();var c=this.getEndDate();this.set(this.endDateField,b);if(d===true&&a&&c){this.setStartDate(Sch.util.Date.add(b,Sch.util.Date.MILLI,-(c-a)))}},setStartEndDate:function(b,a){this.beginEdit();this.set(this.startDateField,b);this.set(this.endDateField,a);this.endEdit()},getDates:function(){var c=[],b=this.getEndDate();for(var a=Ext.Date.clearTime(this.getStartDate(),true);a<b;a=Sch.util.Date.add(a,Sch.util.Date.DAY,1)){c.push(a)}return c},forEachDate:function(b,a){return Ext.each(this.getDates(),b,a)},isValid:function(){var b=this.callParent(arguments);if(b){var c=this.getStartDate(),a=this.getEndDate();b=!c||!a||(a-c>=0)}return b},shift:function(b,a){this.setStartEndDate(Sch.util.Date.add(this.getStartDate(),b,a),Sch.util.Date.add(this.getEndDate(),b,a))},fullCopy:function(){return this.copy.apply(this,arguments)}})}if(!Ext.ClassManager.get("Sch.model.Resource")){Ext.define("Sch.model.Resource",{extend:"Sch.model.Customizable",idProperty:"Id",config:Ext.versions.touch?{idProperty:"Id"}:null,nameField:"Name",customizableFields:[{name:"Name",type:"string"}],getInternalId:function(){return this.internalId},getResourceStore:function(){return this.joined&&this.joined[0]},getEventStore:function(){var a=this.getResourceStore();return a&&a.getEventStore()||this.parentNode&&this.parentNode.getEventStore()},getAssignmentStore:function(){var a=this.getEventStore();return a&&a.getAssignmentStore()},getEvents:function(a){var b=this;a=a||b.getEventStore();return a&&a.getEventsForResource(b)||[]},getAssignments:function(){var b=this,a=b.getEventStore();return a&&a.getAssignmentsForResource(b)},isPersistable:function(){var a=this.parentNode;return !a||!a.phantom||(a.isRoot&&a.isRoot())}})}if(!Ext.ClassManager.get("Sch.model.Event")){Ext.define("Sch.model.Event",{extend:"Sch.model.Range",idProperty:"Id",customizableFields:[{name:"ResourceId"},{name:"Draggable",type:"boolean",persist:false,defaultValue:true},{name:"Resizable",persist:false,defaultValue:true}],resourceIdField:"ResourceId",draggableField:"Draggable",resizableField:"Resizable",getInternalId:function(){return this.internalId},getEventStore:function(){var b=this,a=b.joined&&b.joined[0];if(a&&!a.isEventStore){Ext.Array.sort(b.joined,function(d,c){return(d.isEventStore||false)>(c.isEventStore||false)&&-1||1});a=b.joined[0];a=a.isEventStore?a:null}return a},getResourceStore:function(){var a=this.getEventStore();return a&&a.getResourceStore()},getAssignmentStore:function(){var a=this.getEventStore();return a&&a.getAssignmentStore()},getResources:function(){var b=this,a=b.getEventStore();return a&&a.getResourcesForEvent(b)||[]},forEachResource:function(d,c){var a=this.getResources();for(var b=0;b<a.length;b++){if(d.call(c||this,a[b])===false){return}}},getResource:function(e,b){var d=this,a=null,c;b=b||d.getEventStore();c=b&&b.getResourceStore();e=e==null?d.getResourceId():e;if(b&&(e===null||e===undefined)){a=b.getResourcesForEvent(d);if(a.length==1){a=a[0]}else{if(a.length>1){Ext.Error.raise("Event::getResource() is not applicable for events with multiple assignments, please use Event::getResources() instead.")}else{a=null}}}else{if(c){a=c.getModelById(e)}}return a},setResource:function(c){var b=this,a=b.getEventStore();a&&a.removeAssignmentsForEvent(b);b.assign(c)},assign:function(c){var b=this,a=b.getEventStore();c=c instanceof Sch.model.Resource?c.getId():c;if(a){a.assignEventToResource(b,c)}else{b.setResourceId(c)}},unassign:function(c){var b=this,a=b.getEventStore();c=c instanceof Sch.model.Resource?c.getId():c;if(a){a.unassignEventFromResource(b,c)}else{if(b.getResourceId()==c){b.setResourceId(null)}}},reassign:function(a,b){var d=this,c=d.getEventStore();a=a instanceof Sch.model.Resource?a.getId():a;b=b instanceof Sch.model.Resource?b.getId():b;if(c){c.reassignEventFromResourceToResource(d,a,b)}else{d.setResourceId(b)}},isAssignedTo:function(d){var c=this,b=c.getEventStore(),a=false;d=d instanceof Sch.model.Resource&&d.getId()||d;if(b){a=b.isEventAssignedToResource(c,d)}else{a=c.getResourceId()==d}return a},getAssignments:function(){var b=this,a=b.getEventStore();return a&&a.getAssignmentsForEvent(b)},isDraggable:function(){return this.getDraggable()},isResizable:function(){return this.getResizable()},isPersistable:function(){var b=this,a=b.getEventStore();return a&&a.isEventPersistable(b)}})}if(!Ext.ClassManager.get("Sch.data.util.IdConsistencyManager")){Ext.define("Sch.data.util.IdConsistencyManager",{config:{eventStore:null,resourceStore:null,assignmentStore:null},eventStoreDetacher:null,resourceStoreDetacher:null,constructor:function(a){this.initConfig(a)},updateEventStore:function(a,c){var b=this;Ext.destroyMembers(b,"eventStoreDetacher");if(a){b.eventStoreDetacher=a.on({idchanged:b.onEventIdChanged,scope:b,destroyable:true,priority:200})}},updateResourceStore:function(a,b){var c=this;Ext.destroyMembers(c,"resourceStoreDetacher");if(a){c.resourceStoreDetacher=a.on({idchanged:c.onResourceIdChanged,scope:c,destroyable:true,priority:200})}},onEventIdChanged:function(c,e,g,a){var d=this,f=d.getAssignmentStore(),b;if(f){b=d.getUpdateAssignmentEventIdFieldFn(f,g,a);c.on("update",b,null,{single:true,priority:200})}},onResourceIdChanged:function(i,e,b,d){var h=this,f=h.getEventStore(),g=h.getAssignmentStore(),c,a;if(f&&!g){c=h.getUpdateEventResourceIdFieldFn(f,b,d)}if(g){a=h.getUpdateAssignmentResourceIdFieldFn(g,b,d)}if(c||g){i.on("update",function(){c&&c();a&&a()},null,{single:true,priority:200})}},getUpdateEventResourceIdFieldFn:function(c,d,a){var b=c.getRange();return function(){Ext.Array.forEach(b,function(e){e.getResourceId()==d&&e.setResourceId(a)})}},getUpdateAssignmentEventIdFieldFn:function(c,d,b){var a=c.getAssignmentsForEvent(d);return function(){Ext.Array.forEach(a,function(e){e.getEventId()==d&&e.setEventId(b)})}},getUpdateAssignmentResourceIdFieldFn:function(c,d,b){var a=c.getAssignmentsForResource(d);return function(){Ext.Array.forEach(a,function(e){e.getResourceId()==d&&e.setResourceId(b)})}}})}if(!Ext.ClassManager.get("Sch.data.util.ModelPersistencyManager")){Ext.define("Sch.data.util.ModelPersistencyManager",{config:{eventStore:null,resourceStore:null,assignmentStore:null},eventStoreDetacher:null,resourceStoreDetacher:null,assignmentStoreDetacher:null,constructor:function(a){this.initConfig(a)},updateEventStore:function(a,c){var b=this;Ext.destroyMembers(b,"eventStoreDetacher");if(a&&a.autoSync){b.eventStoreDetacher=a.on({beforesync:b.onEventStoreBeforeSync,scope:b,destroyable:true,priority:100})}},updateResourceStore:function(a,b){var c=this;Ext.destroyMembers(c,"resourceStoreDetacher");if(a&&a.autoSync){c.resourceStoreDetacher=a.on({beforesync:c.onResourceStoreBeforeSync,scope:c,destroyable:true,priority:100})}},updateAssignmentStore:function(a,b){var c=this;Ext.destroyMembers(c,"assignmentStoreDetacher");if(a&&a.autoSync){c.assignmentStoreDetacher=a.on({beforesync:c.onAssignmentStoreBeforeSync,scope:c,destroyable:true,priority:100})}},onEventStoreBeforeSync:function(a){var b=this;b.removeNonPersistableRecordsToCreate(a);return b.shallContinueSync(a)},onResourceStoreBeforeSync:function(a){var b=this;b.removeNonPersistableRecordsToCreate(a);return b.shallContinueSync(a)},onAssignmentStoreBeforeSync:function(a){var b=this;b.removeNonPersistableRecordsToCreate(a);return b.shallContinueSync(a)},removeNonPersistableRecordsToCreate:function(b){var a=b.create||[],d,c;for(c=a.length-1;c>=0;--c){d=a[c];if(!d.isPersistable()){Ext.Array.remove(a,d)}}if(a.length===0){delete b.create}},shallContinueSync:function(a){return Boolean((a.create&&a.create.length>0)||(a.update&&a.update.length>0)||(a.destroy&&a.destroy.length>0))}})}Ext.define("Sch.data.util.ResourceEventsCache",{extend:"Sch.util.Cache",requires:["Ext.data.Model"],eventStore:null,eventStoreDetacher:null,resourceStoreDetacher:null,constructor:function(c){var i=this,j=c.getResourceStore();i.callParent();function l(n,m){Ext.Array.forEach(m,function(o){i.add(o.getResourceId(),o)})}function e(n,m){Ext.Array.forEach(m,function(o){i.remove(o.getResourceId(),o)})}function d(o,r,n,q){var s=r.resourceIdField,p=r.previous&&s in r.previous,m=p&&r.previous[s];if(p){i.move(m,r.getResourceId(),r)}}function g(){i.clear()}function k(n,m,o){i.clear();a(m)}function h(n,o,p,m){i.move(p,m)}function f(m,n){Ext.Array.forEach(n,function(o){i.clear(o)})}function b(){i.clear()}function a(m){Ext.destroy(i.resourceStoreDetacher);i.resourceStoreDetacher=m&&m.on({idchanged:h,remove:f,clear:b,cacheresethint:b,rootchange:b,priority:100,destroyable:true})}i.eventStoreDetacher=c.on({add:l,remove:e,update:d,clear:g,cacheresethint:g,rootchange:g,resourcestorechange:k,priority:100,destroyable:true});i.eventStoreFiltersDetacher=c.getFilters().on("endupdate",g,this,{priority:1002,destroyable:true});a(j);i.eventStore=c},destroy:function(){var a=this;Ext.destroyMembers(a,"eventStoreDetacher","eventStoreFiltersDetacher","resourceStoreDetacher");a.eventStore=null},get:function(a,b){var c=this;a=c.key(a);b=b||function(){return Ext.Array.filter(c.eventStore.getRange(),function(d){return d.getResourceId()==a})};return c.callParent([a,b])}});if(!Ext.ClassManager.get("Sch.data.mixin.UniversalModelGetter")){Ext.define("Sch.data.mixin.UniversalModelGetter",{getModelById:function(b){var a=this;return a.getNodeById?a.getNodeById(b):a.getById(b)},getModelByInternalId:function(b){var a=this;return a.byInternalIdMap?a.byInternalIdMap[b]:a.getByInternalId(b)}})}if(!Ext.ClassManager.get("Sch.data.mixin.CacheHintHelper")){Ext.define("Sch.data.mixin.CacheHintHelper",{extend:"Ext.Mixin",mixinConfig:{before:{loadRecords:"loadRecords"}},loadRecords:function(){var a=this;a.fireEvent("cacheresethint",a)}})}if(!Ext.ClassManager.get("Sch.data.mixin.EventStore")){Ext.define("Sch.data.mixin.EventStore",{extend:"Ext.Mixin",requires:["Sch.util.Date","Sch.data.util.IdConsistencyManager","Sch.data.util.ModelPersistencyManager","Sch.data.util.ResourceEventsCache"],isEventStore:true,resourceStore:null,resourceStoreDetacher:null,assignmentStore:null,resourceEventsCache:null,idConsistencyManager:null,modelPersistencyManager:null,mixinConfig:{after:{constructor:"constructor",destroy:"destroy"}},constructor:function(){var a=this;a.resourceEventsCache=a.createResourceEventsCache();a.idConsistencyManager=a.createIdConsistencyManager();a.modelPersistencyManager=a.createModelPersistencyManager()},destroy:function(){var a=this;Ext.destroyMembers(a,"resourceEventsCache","idConsistencyManager","modelPersistencyManager")},createResourceEventsCache:function(){return new Sch.data.util.ResourceEventsCache(this)},createIdConsistencyManager:function(){var a=this;return new Sch.data.util.IdConsistencyManager({eventStore:a,resourceStore:a.getResourceStore(),assignmentStore:a.getAssignmentStore()})},createModelPersistencyManager:function(){var a=this;return new Sch.data.util.ModelPersistencyManager({eventStore:a,resourceStore:a.getResourceStore(),assignmentStore:a.getAssignmentStore()})},getResourceStore:function(){return this.resourceStore},setResourceStore:function(b){var a=this,c=a.resourceStore;if(a.resourceStore){a.resourceStore.setEventStore(null);a.idConsistencyManager&&a.idConsistencyManager.setResourceStore(null);a.modelPersistencyManager&&a.modelPersistencyManager.setResourceStore(null)}a.resourceStore=b&&Ext.StoreMgr.lookup(b)||null;if(a.resourceStore){a.modelPersistencyManager&&a.modelPersistencyManager.setResourceStore(a.resourceStore);a.idConsistencyManager&&a.idConsistencyManager.setResourceStore(a.resourceStore);b.setEventStore(a)}if((c||b)&&c!==b){a.fireEvent("resourcestorechange",a,b,c)}},getAssignmentStore:function(){return this.assignmentStore},setAssignmentStore:function(b){var a=this,c=a.assignmentStore;if(a.assignmentStore){a.assignmentStore.setEventStore(null);a.idConsistencyManager&&a.idConsistencyManager.setAssignmentStore(null);a.modelPersistencyManager&&a.modelPersistencyManager.setAssignmentStore(null)}a.assignmentStore=b&&Ext.StoreMgr.lookup(b)||null;if(a.assignmentStore){a.modelPersistencyManager&&a.modelPersistencyManager.setAssignmentStore(a.assignmentStore);a.idConsistencyManager&&a.idConsistencyManager.setAssignmentStore(a.assignmentStore);a.assignmentStore.setEventStore(a);Ext.destroy(a.resourceEventsCache)}else{a.resourceEventsCache=a.createResourceEventsCache()}if((c||b)&&c!==b){a.fireEvent("assignmentstorechange",a,b,c)}},isDateRangeAvailable:function(g,a,c,e){var f=Sch.util.Date,b=this.getEventsForResource(e),d=true;Ext.each(b,function(h){d=(c===h||!f.intersectSpans(g,a,h.getStartDate(),h.getEndDate()));return d});return d},getEventsInTimeSpan:function(f,b,a){var d=new Ext.util.MixedCollection();var c=[];if(a!==false){var e=Sch.util.Date;this.forEachScheduledEvent(function(i,h,g){if(e.intersectSpans(h,g,f,b)){c.push(i)}})}else{this.forEachScheduledEvent(function(i,h,g){if(h-f>=0&&b-g>=0){c.push(i)}})}d.addAll(c);return d},forEachScheduledEvent:function(b,a){this.each(function(e){var d=e.getStartDate(),c=e.getEndDate();if(d&&c){return b.call(a||this,e,d,c)}},this)},getTotalTimeSpan:function(){var a=new Date(9999,0,1),b=new Date(0),c=Sch.util.Date;this.each(function(d){if(d.getStartDate()){a=c.min(d.getStartDate(),a)}if(d.getEndDate()){b=c.max(d.getEndDate(),b)}});a=a<new Date(9999,0,1)?a:null;b=b>new Date(0)?b:null;this.lastTotalTimeSpan={start:a||null,end:b||a||null};return this.lastTotalTimeSpan},filterEventsForResource:function(d,c,b){var a=d.getEvents(this);return Ext.Array.filter(a,c,b||this)},append:function(a){throw"Must be implemented by consuming class"},getResourcesForEvent:function(d){var c=this,e=c.getAssignmentStore(),b=c.getResourceStore(),a;if(e){a=e.getResourcesForEvent(d)}else{if(b){d=d instanceof Sch.model.Event&&d||c.getModelById(d);a=d&&b.getModelById(d.getResourceId());a=a&&[a]||[]}else{a=[]}}return a},getEventsForResource:function(d){var c=this,e=c.getAssignmentStore(),b,a;if(e){a=e.getEventsForResource(d)}else{if(c.resourceEventsCache){a=c.resourceEventsCache.get(d)}else{a=[]}}return a},getAssignmentsForEvent:function(b){var a=this,c=a.getAssignmentStore();return c&&c.getAssignmentsForEvent(b)||[]},getAssignmentsForResource:function(b){var a=this,c=a.getAssignmentStore();return c&&c.getAssignmentsForResource(b)||[]},assignEventToResource:function(b,c){var a=this,d=a.getAssignmentStore();if(d){d.assignEventToResource(b,c)}else{b=b instanceof Sch.model.Event&&b||a.getModelById(b);c=c instanceof Sch.model.Resource?c.getId():c;b&&b.setResourceId(c)}},unassignEventFromResource:function(b,c){var a=this,d=a.getAssignmentStore();if(d){d.unassignEventFromResource(b,c)}else{b=b instanceof Sch.model.Event&&b||a.getModelById(b);c=c instanceof Sch.model.Resource?c.getId():c;if(b&&b.getResourceId()==c){b.setResourceId(null)}}},reassignEventFromResourceToResource:function(d,a,b){var c=this,e=c.getAssignmentStore();if(e){e.unassignEventFromResource(d,a);e.assignEventToResource(d,b)}else{d=d instanceof Sch.model.Event&&d||c.getModelById(d);a=a instanceof Sch.model.Resource?a.getId():a;b=b instanceof Sch.model.Resource?b.getId():b;if(d.getResourceId()==a){d.setResourceId(b)}}},isEventAssignedToResource:function(c,d){var b=this,e=b.getAssignmentStore(),a;if(e){a=e.isEventAssignedToResource(c,d)}else{c=c instanceof Sch.model.Event&&c||b.getModelById(c);d=d instanceof Sch.model.Resource?d.getId():d;a=c&&(c.getResourceId()==d)||false}return a},removeAssignmentsForEvent:function(b){var a=this,c=a.getAssignmentStore();if(c){c.removeAssignmentsForEvent(b)}else{b=b instanceof Sch.model.Event&&b||a.getModelById(b);b&&b.setResourceId(null)}},removeAssignmentsForResource:function(c){var b=this,d=b.getAssignmentStore(),a=b.getResourceStore();if(d){d.removeAssignmentsForResource(c)}else{if(a){c=c instanceof Sch.model.Resource&&c||a.getModelById(c);c&&Ext.Array.forEach(b.resourceEventsCache.get(c),function(e){e.setResourceId(null)})}else{c=c instanceof Sch.model.Resource?c.getId():c;Ext.Array.forEach(b.getRange(),function(e){e.getResourceId()==c&&e.setResourceId(null)})}}},isEventPersistable:function(e){var d=this,g=d.getAssignmentStore(),f,c,b,a=true;if(!g){f=e.getResources();for(c=0,b=f.length;a&&c<b;++c){a=f[c].phantom!==true}}return a}})}if(!Ext.ClassManager.get("Sch.data.mixin.ResourceStore")){Ext.define("Sch.data.mixin.ResourceStore",{eventStore:null,getEventStore:function(){return this.eventStore},setEventStore:function(a){var b=this,c;if(b.eventStore!==a){c=b.eventStore;b.eventStore=a&&Ext.StoreMgr.lookup(a)||null;b.fireEvent("eventstorechange",b,a,c)}}})}if(!Ext.ClassManager.get("Sch.data.EventStore")){Ext.define("Sch.data.EventStore",{extend:"Ext.data.Store",alias:"store.eventstore",mixins:["Sch.data.mixin.UniversalModelGetter","Sch.data.mixin.CacheHintHelper","Sch.data.mixin.EventStore"],storeId:"events",model:"Sch.model.Event",config:{model:"Sch.model.Event"},proxy:"memory",constructor:function(a){var b=this;b.callParent([a]);b.resourceStore&&b.setResourceStore(b.resourceStore);b.assignmentStore&&b.setAssignmentStore(b.assignmentStore);if(b.getModel()!==Sch.model.Event&&!(b.getModel().prototype instanceof Sch.model.Event)){throw"The model for the EventStore must subclass Sch.model.Event"}},append:function(a){this.add(a)}})}if(!Ext.ClassManager.get("Sch.data.ResourceStore")){Ext.define("Sch.data.ResourceStore",{extend:"Ext.data.Store",model:"Sch.model.Resource",config:{model:"Sch.model.Resource"},alias:"store.resourcestore",requires:["Sch.patches.OperationDestroy"],mixins:["Sch.data.mixin.UniversalModelGetter","Sch.data.mixin.CacheHintHelper","Sch.data.mixin.ResourceStore"],storeId:"resources",proxy:"memory",constructor:function(){this.callParent(arguments);if(this.getModel()!==Sch.model.Resource&&!(this.getModel().prototype instanceof Sch.model.Resource)){throw"The model for the ResourceStore must subclass Sch.model.Resource"}}})}Ext.define("Kanban.locale.Ko",{extend:"Sch.locale.Locale",singleton:true,constructor:function(a){Ext.apply(this,{l10n:{"Kanban.menu.TaskMenuItems":{copy:"복사",remove:"삭제",edit:"수정",states:"이동",users:"배차"}},NotStarted:"대기",InProgress:"진행중",Test:"검사",Done:"완료"});this.callParent(arguments)}});Ext.define("Kanban.model.Resource",{extend:"Sch.model.Resource",customizableFields:[{name:"ImageUrl"}],imageUrlField:"ImageUrl"});Ext.define("Kanban.model.Task",{extend:"Sch.model.Event",resourceStore:null,states:["NotStarted","InProgress","Test","Done"],customizableFields:[{name:"State",defaultValue:"NotStarted"},{name:"Position",type:"int"},{name:"CreatedDate",type:"date"},{name:"ImageUrl"}],constructor:function(){this.callParent(arguments);if(this.phantom&&!this.getCreatedDate()){this.setCreatedDate(new Date())}},stateField:"State",imageUrlField:"ImageUrl",createdDateField:"CreatedDate",positionField:"Position",getResourceStore:function(){if(!this.resourceStore){Ext.Array.each(this.joined,function(a){if(a.resourceStore){this.resourceStore=a.resourceStore;return false}},this)}return this.resourceStore},isValidTransition:function(a){switch(this.getState()){case"NotStarted":return a=="InProgress";case"InProgress":return a!="Done";case"Test":return a!="NotStarted";case"Done":return a=="Test"||a=="InProgress";default:return true}}});Ext.define("Kanban.data.mixin.StoreView",{state:null,masterStore:null,bindToStore:function(a){var b={add:this.onMasterAdd,clear:this.onMasterClear,remove:this.onMasterRemove,update:this.onMasterUpdate,refresh:this.onMasterDataChanged,scope:this};if(this.masterStore){this.masterStore.un(b)}this.masterStore=a;if(a){a.on(b);this.copyStoreContent()}},onMasterAdd:function(b,a){for(var c=0;c<a.length;c++){if(a[c].getState()===this.state){this.add(a[c])}}},onMasterClear:function(){this.removeAll()},onMasterUpdate:function(c,a,b,d){if(d&&Ext.Array.indexOf(d,c.model.prototype.stateField)>=0){if(this.state===a.getState()){this.add(a)}if(this.state===a.previous[a.stateField]){this.remove(a)}}},onMasterRemove:function(b,a){Ext.Array.each(a,function(c){if(c.getState()===this.state){this.remove(c)}},this)},onMasterDataChanged:function(a){this.copyStoreContent()},copyStoreContent:function(){var b=this.state;var a=[];this.masterStore.each(function(c){if(c.getState()===b){a[a.length]=c}});this.suspendEvents();this.sort(this.masterStore.getSorters().items);this.sorters.removeAll();this.resumeEvents();this.loadData(a)}});Ext.define("Kanban.data.ViewStore",{extend:"Ext.data.Store",mixins:["Kanban.data.mixin.StoreView"],proxy:"memory",masterStore:null,state:null,constructor:function(a){Ext.apply(this,a);if(this.state===null||this.state===undefined){throw"Must supply state"}if(this.masterStore){var b=this.masterStore=Ext.StoreMgr.lookup(this.masterStore);var c=b.sorters;this.model=b.model}else{throw"Must supply a master store"}this.callParent(arguments);if(this.masterStore){this.bindToStore(this.masterStore)}},getResourceStore:function(){return this.masterStore.getResourceStore()}});Ext.define("Kanban.data.ResourceStore",{extend:"Sch.data.ResourceStore",model:"Kanban.model.Resource",sorters:"Name",proxy:undefined,alias:"store.kanban_resourcestore"});Ext.define("Kanban.data.TaskStore",{extend:"Sch.data.EventStore",model:"Kanban.model.Task",proxy:undefined,alias:"store.kanban_taskstore",resourceStore:null,setResourceStore:function(a){this.resourceStore=Ext.data.StoreManager.lookup(a)},getResourceStore:function(){return this.resourceStore},constructor:function(){this.callParent(arguments);var a=this.getModel();this.setSorters([{property:a.prototype.positionField,direction:"ASC"},{property:a.prototype.nameField,direction:"ASC"}])}});Ext.define("Kanban.dd.DragZone",{extend:"Ext.dd.DragZone",mixins:{observable:"Ext.util.Observable"},requires:["Ext.util.Point"],panel:null,repairHighlight:false,repairHighlightColor:"transparent",containerScroll:false,autoOffset:function(a,b){this.setDelta(this.dragData.offsets[0],this.dragData.offsets[1])},setVisibilityForSourceEvents:function(a){Ext.each(this.dragData.taskEls,function(b){b[a?"removeCls":"addCls"]("sch-hidden")})},constructor:function(a){if(Ext.isIE8m&&window.top!==window){Ext.dd.DragDropManager.notifyOccluded=true}this.mixins.observable.constructor.call(this,a);this.callParent(arguments);this.proxy.el.child(".x-dd-drag-ghost").removeCls("x-dd-drag-ghost");this.proxy.addCls("sch-task-dd")},getPlaceholderElements:function(b,f){var e=f.taskEls;var h;var a=f.offsets[0];var g=f.offsets[1];var d=b.getHeight();var c=Ext.core.DomHelper.createDom({tag:"div",cls:"sch-dd-wrap-holder"});Ext.Array.each(e,function(l,j){h=l.dom.cloneNode(true);h.innerHTML="";h.id=Ext.id();h.boundView=l.dom.boundView;var k=Ext.fly(h);k.removeCls("sch-task-selected");k.addCls("sch-task-placeholder");c.appendChild(h);Ext.fly(h).setStyle({width:l.getWidth()+"px",height:l.getHeight()+"px"})});return c},getDragData:function(i){var a=this.panel,o=i.getTarget(a.taskSelector);if(!o||a.isReadOnly()){return}var c=a.resolveRecordByNode(o);if(!c||c.isDraggable()===false||this.fireEvent("beforetaskdrag",this,c,i)===false){return null}var p=i.getXY(),j=Ext.get(o),m=j.getXY(),f=[p[0]-m[0],p[1]-m[1]],k=Ext.getCmp(j.up(".sch-taskview").id),n=j.getRegion();if(!k.isSelected(o)&&!i.ctrlKey){this.fireEvent("taskdragstarting",this,c,i)}var h=this.getDraggingRecords(c),d=[];Ext.Array.forEach(h,function(q){var e=a.getElementForTask(q);if(e){d.push(e)}});var g={view:k,sourceZoomLevel:k.up("panel").zoomLevel,offsets:f,repairXY:[i.getX()-f[0],i.getY()-f[1]],taskEls:d,bodyScroll:Ext.getBody().getScroll(),taskRecords:h};var l=k.getStore();var b=l.getAt(l.indexOf(c)+1);if(b){g.dropOptions={task:b,type:"before"}}g.ddel=this.getDragElement(j,g);g.placeholder=this.getPlaceholderElements(j,g);this.proxy.el.set({size:this.panel.getZoomLevel()});return g},onStartDrag:function(b,c){var a=this.dragData;Ext.fly(a.placeholder).insertBefore(a.taskEls[0]);Ext.Array.forEach(a.taskEls,function(d){d.addCls("sch-hidden")});this.fireEvent("taskdragstart",this,a.taskRecords)},getDraggingRecords:function(c){var b=this.getRelatedRecords(c);var a=c.store;if(b[0]&&b[0].getState()==c.getState()){b=Ext.Array.sort([c].concat(b),this.positionSorter)}else{b=[c].concat(Ext.Array.sort(b,this.positionSorter))}return b},positionSorter:function(d,c){var e=d.store;return e.indexOf(d)>e.indexOf(c)?1:-1},getRelatedRecords:function(d){var b=this.panel;var c=b.getSelectedRecords();var a=[];Ext.each(c,function(e){if(e.getId()!==d.getId()){a.push(e)}});return a},getDragElement:function(j,f){var d=f.taskEls;var b;var g=f.offsets[0];var e=f.offsets[1];var c=this.panel.getElementForTask(f.taskRecords[0]).getHeight();if(d.length>1){var h=Ext.core.DomHelper.createDom({tag:"div",cls:"sch-dd-wrap",style:{overflow:"visible"}});Ext.Array.forEach(d,function(m,k){b=m.dom.cloneNode(true);b.id="";b.className+=k===0?" sch-dd-source":" sch-dd-extra";var l=m.up("[size]");var n=Ext.core.DomHelper.createDom({tag:"div",size:l.getAttribute("size")}).cloneNode(true);n.appendChild(b);h.appendChild(n);Ext.fly(b).setStyle({left:(k>0?10:0)+"px",top:(k===0?0:(c-30+k*20))+"px",width:m.getWidth()+"px",height:m.getHeight()+"px",position:"absolute"})});return h}else{b=j.dom.cloneNode(true);b.id="";b.style.width=j.getWidth()+"px";b.style.height=j.getHeight()+"px";var i=j.up("[size]");var a=Ext.core.DomHelper.createDom({tag:"div",size:i.getAttribute("size")}).cloneNode(true);a.appendChild(b);return a}},getRepairXY:function(b,a){return a.repairXY},afterRepair:function(){this.dragging=false},onInvalidDrop:function(c,b,d){if(!b){b=c;c=b.getTarget()||document.body}var a=this.callParent([c,b,d]);this.fireEvent("aftertaskdrop",this,this.dragData.taskRecords);if(this.dragData.placeholder){Ext.fly(this.dragData.placeholder).remove()}this.setVisibilityForSourceEvents(true);return a}});Ext.define("Kanban.dd.DropZone",{extend:"Ext.dd.DropZone",mixins:{observable:"Ext.util.Observable"},constructor:function(a){this.callParent(arguments);this.mixins.observable.constructor.call(this,a)},panel:null,dragData:null,getTargetFromEvent:function(a){return a.getTarget()},validatorFn:Ext.emptyFn,validatorFnScope:null,zoomLevels:["large","medium","small","mini"],shouldDropBeforeNode:function(g,e,b){var h=Ext.fly(e).getBox();var c=b.proxy.getXY();var d;if(this.dropMode=="vertical"){d=(h.bottom-h.top)/2;if(this.direction.up){return c[1]-h.top<d}else{var a=Ext.fly(b.dragData.placeholder.children[0]).getHeight();return c[1]+a-h.top<d}}else{d=(h.right-h.left)/2;if(Ext.Array.indexOf(this.zoomLevels,b.dragData.currentZoomLevel)>Ext.Array.indexOf(this.zoomLevels,b.dragData.sourceZoomLevel)){if(g[1]<h.top){return true}else{if(g[1]>h.bottom){return false}}return g[0]-h.left<(h.right-h.left)/2}else{if(g[1]<h.top){return true}else{if(g[1]>h.bottom){return false}}if(this.direction.left){return(c[0]-h.left<d)}else{var f=Ext.fly(b.dragData.placeholder.children[0]).getWidth();return(c[0]+f-h.left<d)}}}},getDropMode:function(a){var b=Ext.DomQuery.select(a.getItemSelector()+":not(.sch-hidden)",a.el.dom)[0];if(!b){return"vertical"}if(Ext.fly(b).getWidth()*2<a.getWidth()){return"horizontal"}return"vertical"},updatePlaceholderElements:function(g,e){var f;var d=Ext.core.DomHelper.createDom({tag:"div",cls:"sch-dd-wrap-holder"});for(var b=0,a=e.taskRecords.length;b<a;b++){f=g.cloneNode(true);f.innerHTML="";f.boundView=g.boundView;f.id=Ext.id();var c=Ext.fly(f);c.removeCls("sch-task-selected");c.addCls("sch-task-placeholder");d.appendChild(f);Ext.fly(f).setStyle({width:g.offsetWidth+"px",height:g.offsetHeight+"px"})}return d},getSmallestTask:function(a){var b=Ext.DomQuery.select(a.getItemSelector()+":not(.sch-hidden)",a.el.dom);var d=b[0];for(var c=0;c<b.length;c++){d=d.offsetHeight>b[c].offsetHeight?b[c]:d}return d},getNodeByCoordinate:function(a,b){return document.elementFromPoint(a[0]-b.left,a[1]-b.top)},getTargetView:function(f,d,c){var b=this.getNodeByCoordinate(f,c.bodyScroll);if(Ext.isIE8&&d){b=this.getNodeByCoordinate(f,c.bodyScroll)}if(b){if(!b.className.match("sch-taskview")){var a=Ext.fly(b).up(".sch-taskview");if(a){b=a.dom}else{b=null}}if(b){return Ext.getCmp(b.id)}}return null},onNodeOver:function(s,r,q,t){var f=q.getXY();this.direction={left:false,up:false};var m=this.prevXY;if(m){if(m[0]>f[0]){this.direction.left=true}else{}if(m[1]>f[1]){this.direction.up=true}}this.prevXY=f;var j=r.proxy.el.dom;var c=false;j.style.display="none";var n=this.getTargetView(f,q,t);j.style.display="block";if(!n){return this.dropNotAllowed}if(n){c=t.taskRecords[0].isValidTransition(n.state);if(c){if(n!=t.view){var a=this.getSmallestTask(n);if(a){Ext.fly(t.placeholder).remove();t.placeholder=this.updatePlaceholderElements(a,t)}}if(n!=t.view||!this.dropMode){this.dropMode=this.getDropMode(n);t.currentZoomLevel=n.up("panel").zoomLevel}t.view=n;var h=Ext.get(t.placeholder);var o=n.all.elements.slice(),d=0,b=o.length-1,g,i,l;if(o.length){while(b-d>1){i=Math.floor((d+b)/2);g=o[i];if(Ext.fly(g).isVisible()){l=this.shouldDropBeforeNode(f,g,r);if(l){b=i}else{d=i}}else{o.splice(i,1);b=b-1}}var p=o[d],k=this.shouldDropBeforeNode(f,p,r);if(k){g=p;l=true}else{if(Ext.fly(o[b]).isVisible()){g=o[b];l=this.shouldDropBeforeNode(f,g,r)}else{g=p;l=false}}}if(g){if(l){h.insertBefore(g);t.dropOptions={task:n.getRecord(g),type:"before"}}else{h.insertAfter(g);t.dropOptions={task:n.getRecord(g),type:"after"}}}else{n.el.appendChild(h);t.dropOptions=null}}}return c?this.dropAllowed:this.dropNotAllowed},notifyDrop:function(i,d,c){var j=d.getXY();i.proxy.el.dom.style.display="none";var h=this.getTargetView(j,d,c);i.proxy.el.dom.style.display="block";var f=this,b=h&&h.state,g=true,a=b!==false&&b!==null;c.newState=b;c.view=h;c.proxy=i.proxy;c.finalize=function(){f.finalize.apply(f,arguments)};a=a&&f.validatorFn.call(f.validatorFnScope||this,c.taskRecords,b)!==false;this.dragData=c;g=f.fireEvent("beforetaskdropfinalize",f,c,d)!==false;if(g){return f.finalize(a)}return true},finalize:function(h){var g=this.dragData,k=g.proxy,a=[];Ext.fly(this.getEl()).select(".sch-dd-wrap-holder").remove();Ext.Array.forEach(g.taskEls,function(j){j.removeCls("sch-hidden")});if(h){var c=g.taskRecords,l=c[0].positionField,e=g.newState,b=g.dropOptions,f=g.view.getStore();Ext.Array.each(c,function(j){if(j.isValidTransition(e)){j.setState(e);a.push(j)}});if(a.length>0){f.remove(a);var i=b?(f.indexOf(b.task)+(b.type=="before"?0:1)):f.getCount();f.insert(i,a);for(var d=0;d<f.getCount();d++){f.getAt(d).set(l,d,{silent:true})}f.sort(this.masterStoreSorters)}}if(a.length===0){k.el.dom.style.display="block";k.el.animate({duration:500,easing:"ease-out",to:{x:g.repairXY[0],y:g.repairXY[1]},stopAnimation:true})}else{this.fireEvent("taskdrop",this,g.taskRecords)}delete this.dropMode;this.fireEvent("aftertaskdrop",this,g.taskRecords);if(g.placeholder){Ext.fly(g.placeholder).remove()}return a.length>0}});Ext.define("Kanban.field.AddNew",{extend:"Ext.form.TextField",alias:"widget.addnewfield",enableKeyEvents:true,emptyText:"Add new task...",store:null,defaults:null,initComponent:function(){this.on("keyup",this.onMyKeyUp,this);if(Ext.isString(this.store)){this.store=Ext.getStore(this.store)}this.callParent(arguments)},onMyKeyUp:function(b,a){if(a.getKey()===a.ENTER){this.addTask()}},addTask:function(){var a={};a[this.store.model.prototype.nameField]=this.getValue();this.store.add(Ext.apply(a,this.defaults));this.setValue()}});Ext.define("Kanban.field.TaskFilter",{extend:"Ext.form.TextField",alias:"widget.filterfield",requires:["Ext.util.Filter"],enableKeyEvents:true,height:26,minLength:2,store:null,caseSensitive:false,initComponent:function(){this.on("change",this.onMyChange,this);this.store=Ext.data.StoreManager.lookup(this.store);this.field=this.field||this.store.getModel().prototype.nameField;this.filter=new Ext.util.Filter({id:this.getId()+"-filter",property:this.field,value:"",caseSensitive:this.caseSensitive,anyMatch:true});this.callParent(arguments)},onMyChange:function(){var a=this.getValue();if(a&&a.length>=this.minLength){this.filter.setValue(a);this.store.addFilter(this.filter)}else{this.store.removeFilter(this.filter)}}});Ext.define("Kanban.field.TaskHighlight",{extend:"Ext.form.TextField",alias:"widget.highlightfield",mixins:["Ext.AbstractPlugin"],enableKeyEvents:true,minLength:2,preventMark:true,height:26,panel:null,field:"Name",caseSensitive:false,initComponent:function(){this.on("keyup",this.onMyKeyUp,this);this.callParent(arguments)},onMyKeyUp:function(c,b){var d=this.getValue();if(d&&d.length>=this.minLength){var a=[];d=this.caseSensitive?d:d.toLowerCase();this.panel.highlightTasksBy(function(f){var e=this.caseSensitive?f.data[this.field]:f.data[this.field].toLowerCase();return e&&e.indexOf(d)>=0},this)}else{this.panel.clearHighlight()}}});Ext.define("Kanban.field.ColumnFilter",{extend:"Ext.form.ComboBox",alias:"widget.columnfilter",requires:["Ext.data.JsonStore"],multiSelect:true,valueField:"id",displayField:"name",panel:null,queryMode:"local",listConfig:{cls:"sch-columnfilter-list"},initComponent:function(){this.store=new Ext.data.JsonStore({proxy:"memory",fields:["id","name"]});this.updateListItems(true);this.callParent(arguments);this.getPicker().on({beforeshow:this.onMyBeforeExpand,scope:this});this.getPicker().on({show:function(a){a.on("selectionchange",this.onMySelect,this)},hide:function(a){a.un("selectionchange",this.onMySelect,this)},delay:50,scope:this})},updateListItems:function(b){var a=Sch.locale.Active["Kanban.locale"]||{},d=[],c=[];Ext.each(this.panel.query("taskcolumn"),function(e){d.push({id:e.state,name:e.origTitle||a[e.state]||e.state});if(b&&!e.hidden){c.push(e.state)}});if(b){this.value=this.value||c}this.store.loadData(d);if(!b){this.onMyBeforeExpand()}},onMySelect:function(b,a){this.store.each(function(c){this.panel.down("[state="+c.get("id")+"]")[Ext.Array.indexOf(a,c)>=0?"show":"hide"]()},this)},onMyBeforeExpand:function(){var a=this.panel;var b=this;var c=[];Ext.each(a.query("taskcolumn"),function(d){if(d.isVisible()){c.push(b.store.getById(d.state))}});b.select(c)}});Ext.define("Kanban.editor.Base",{triggerEvent:"taskdblclick",panel:null,selector:".sch-task",editRecord:function(a,c){if(this.panel.isReadOnly()){return}var b=this.panel.getElementForTask(a);if(b){this.triggerEdit(a,c)}},triggerEdit:function(a,b){throw"Abstract method call"},init:function(a){this.panel=a;if(this.triggerEvent){a.on(this.triggerEvent,function(c,b,d,f){this.editRecord(b,f)},this);a.on("taskkeydown",function(b,c,d,f){if(f.getKey()===f.ENTER&&f.getTarget().nodeName.toLowerCase()!=="input"){this.editRecord(c,f)}},this)}}});Ext.define("Kanban.editor.SimpleEditor",{extend:"Ext.Editor",mixins:["Kanban.editor.Base"],alias:"widget.kanban_simpleeditor",alignment:"tl",autoSize:{width:"boundEl"},listeners:{complete:"onEditDone"},selector:".sch-task-name",dataIndex:"Name",field:{xtype:"textfield",minWidth:100,allowEmpty:false},triggerEdit:function(a){var b=this.panel.getElementForTask(a);if(b){this.record=a;this.startEdit(b.down(this.selector))}},onEditDone:function(){this.record.set(this.dataIndex,this.getValue())}});Ext.define("Kanban.menu.UserMenu",{extend:"Ext.menu.Menu",alias:"widget.kanban_usermenu",cls:"sch-usermenu",plain:true,resourceStore:null,initComponent:function(){var a=this;Ext.apply(this,{renderTo:document.body,listeners:{beforeshow:function(){var b=this.task.getResource();if(b){this.items.each(function(c){if(b==c.user){c.addCls("sch-user-selected")}else{c.removeCls("sch-user-selected")}})}}}});this.resourceStore=Ext.data.StoreManager.lookup(this.resourceStore);this.mon(this.resourceStore,{load:this.populate,add:this.populate,remove:this.populate,update:this.populate,scope:this});this.callParent(arguments);this.populate()},showForTask:function(a,b){this.task=a;this.showAt(b)},onUserSelected:function(a){this.task.assign(a.user)},populate:function(){var b=this;var a=[];this.resourceStore.each(function(c){a.push({text:c.getName(),user:c,handler:b.onUserSelected,scope:b})});this.removeAll(true);this.add(a)}});Ext.define("Kanban.menu.UserPicker",{extend:"Ext.view.View",alias:["widget.userpicker","widget.kanban_userpicker"],cls:"sch-userpicture-view",autoScroll:true,showName:true,padding:"10 5 5 5",itemSelector:".sch-user",overItemCls:"sch-user-hover",selectedItemCls:"sch-user-selected",initComponent:function(){var b=this.store&&this.store.model&&this.store.model.prototype;var a=b&&b.nameField||"Name";var c=b&&b.imageUrlField||"ImageUrl";Ext.apply(this,{itemTpl:'<tpl for="."><div class="sch-user"><img src="{'+c+':htmlEncode}" />'+(this.showName?"<span>{"+a+":htmlEncode}</span>":"")+"</div></tpl>"});this.callParent(arguments)}});Ext.define("Kanban.menu.UserPictureMenu",{extend:"Ext.menu.Menu",alias:["widget.userpicturemenu","widget.kanban_userpicturemenu"],requires:["Kanban.menu.UserPicker"],cls:"sch-userpicturemenu",width:290,height:200,resourceStore:null,hideOnSelect:true,initComponent:function(){var b=this,a=Ext.apply({},b.initialConfig);delete a.listeners;Ext.apply(b,{plain:true,showSeparator:false,bodyPadding:0,items:Ext.applyIf({margin:0,store:this.resourceStore,xtype:"userpicker"},a)});b.callParent(arguments);b.picker=b.down("userpicker");b.relayEvents(b.picker,["select"]);if(b.hideOnSelect){b.on("select",b.onUserSelected,b)}this.mon(Ext.getBody(),"click",this.onBodyClick,this)},showForTask:function(b,c){this.task=b;this.showAt(c);var a=b.getResource();if(a){this.picker.select(a,false,true)}else{this.picker.getSelectionModel().deselectAll()}},onUserSelected:function(b,a){this.hide();this.task.assign(a)},onBodyClick:function(b,a){if(!b.within(this.el)){this.hide()}}});Ext.define("Kanban.menu.TaskMenuItems",{requires:["Kanban.editor.SimpleEditor","Kanban.menu.UserMenu"],mixins:["Sch.mixin.Localizable"],taskBoard:null,mainMenu:null,defaultActions:null,editorClass:null,editor:null,userMenuClass:null,userMenu:null,constructor:function(a){Ext.apply(this,a);this.mainMenu.on("beforeshow",this.onBeforeShow,this);this.items=this.items||[];if(this.defaultActions){this.initEditor();this.initUserMenu();this.initStateMenu();this.items=this.items.concat([{action:"edit",text:this.L("edit"),handler:this.onEditClick,scope:this},{action:"assign",text:this.L("users"),menu:this.userMenu},{action:"setState",text:this.L("states"),menu:this.stateMenu},{action:"copy",text:this.L("copy"),handler:this.onCopyClick,scope:this},{action:"remove",text:this.L("remove"),handler:this.onRemoveClick,scope:this}])}this.callParent(arguments)},onBeforeShow:function(b){var a=b.getTask();if(this.userMenu){this.userMenu.task=a}if(this.editor){this.editor.task=a}},getItems:function(){return this.items},initEditor:function(){if(!this.editor){if(this.taskBoard.getTaskEditor()){this.editor=this.taskBoard.getTaskEditor()}else{this.editor=Ext.create(this.editorClass,{dataIndex:this.taskBoard.taskStore.model.prototype.nameField,panel:this.taskBoard})}}},onEditClick:function(a,b){this.editor.editRecord(this.mainMenu.getTask(),b)},initUserMenu:function(){if(!this.userMenu){this.userMenu=Ext.create(this.userMenuClass,{resourceStore:this.taskBoard.resourceStore,onBodyClick:Ext.emptyFn})}},initStateMenu:function(){var g=this,f=this.taskBoard.taskStore.model,b=f.prototype.stateField,d=f.prototype.states;var a=Sch.locale.Active["Kanban.locale"]||{};var c=Ext.Array.map(d,function(h){return{text:a[h]||h,state:h,handler:g.onStateClick,scope:g}});var e=g.mainMenu;this.stateMenu=new Ext.menu.Menu({items:c,plain:true,listeners:{show:function(){var h=e.getTask().get(b);this.items.each(function(i){i.setDisabled(i.state===h)})}}})},onStateClick:function(a){this.mainMenu.task.setState(a.state)},onCopyClick:function(d){var c=this.taskBoard.taskStore,b=this.mainMenu.getTask(),a=b.copy(null);a.setName(a.getName());c.add(a)},onRemoveClick:function(c){var b=this.taskBoard.taskStore,a=this.mainMenu.getTask();b.remove(a)}});Ext.define("Kanban.menu.TaskMenu",{extend:"Ext.menu.Menu",requires:["Kanban.menu.TaskMenuItems"],isTaskMenu:true,alias:"widget.kanban_taskmenu",cls:"sch-task-menu",handleCls:"sch-task-menu-handle",taskBoard:null,config:{task:null},hideHandleTimer:null,handleHideDelay:500,currentHandle:null,editorClass:"Kanban.editor.SimpleEditor",userMenuClass:"Kanban.menu.UserMenu",defaultActions:true,itemFactoryClass:"Kanban.menu.TaskMenuItems",initComponent:function(){this.on("beforeshow",this.onBeforeShow,this);if(this.defaultActions){this.items=Ext.create(this.itemFactoryClass,{editorClass:this.editorClass,userMenuClass:this.userMenuClass,defaultActions:this.defaultActions,items:this.items||[],taskBoard:this.taskBoard,mainMenu:this}).getItems()}this.callParent(arguments)},registerListeners:function(){this.mon(this.taskBoard.el,{click:this.onMenuHandleClick,delegate:"."+this.handleCls,scope:this});this.mon(this.taskBoard,{taskmouseenter:this.onHandleMouseOver,taskmouseleave:this.onHandleMouseLeave,scope:this})},showForTask:function(a,d,c){var b=d.getTarget(".sch-task");this.setTask(a);this.show();this.alignTo(b,"tl-tr?")},onMenuHandleClick:function(c,b){var a=this.taskBoard.resolveRecordByNode(b);c.stopEvent();this.showForTask(a,c,b)},onHandleMouseOver:function(a,b,c,e,d){window.clearTimeout(this.hideHandleTimer);this.hide();this.currentHandle&&this.currentHandle.setVisible(false);this.currentHandle=Ext.select("."+this.handleCls,false,c).setVisible(true)},onHandleMouseLeave:function(a,b,c,e,d){this.hideHandleTimer=Ext.defer(function(){this.currentHandle.setVisible(false)},this.handleHideDelay,this)},shouldShowItem:function(b,a){return true},onBeforeShow:function(b){var a=this.getTask();this.items.each(function(c){c.task=a;c.setVisible(this.shouldShowItem(c,a))},this)}});Ext.define("Kanban.template.Task",{extend:"Ext.XTemplate",model:null,menuIconTpl:'<div class="sch-task-menu-handle"></div>',constructor:function(c){var e=this;Ext.apply(e,c);var d=e.model.prototype;var b=d.idProperty;var a=d.nameField;if(typeof e.taskBodyTpl!=="string"){e.taskBodyTpl='<tpl if="'+d.imageUrlField+'"><img class="sch-task-img" src="{taskImageUrl:htmlEncode}"/></tpl><span class="sch-task-id">{[ values.'+b+' ? "#" + values.'+b+' : "" ]}</span><span class="sch-task-name"> {'+a+":htmlEncode}</span>"}if(typeof e.resourceImgTpl!=="string"){e.resourceImgTpl='<img src="{resourceImageUrl:htmlEncode}" class="sch-user-avatar {resourceImageCls:htmlEncode}" />'}e.callParent(['<tpl for=".">','<div class="sch-task sch-task-state-{'+d.stateField+":htmlEncode} {"+d.clsField+':htmlEncode} {cls:htmlEncode}" style="{style}"><div class="sch-task-inner">'+e.taskBodyTpl+e.resourceImgTpl+(e.taskToolTpl||"")+"</div>"+e.menuIconTpl+"</div></tpl>"])}});Ext.define("Kanban.selection.TaskModel",{extend:"Ext.mixin.Observable",panel:null,selModels:null,constructor:function(a){var b=this;Ext.apply(b,a);b.callParent(arguments);b.selModels=Ext.Array.map(b.panel.views,function(c){return c.getSelectionModel()});b.forEachView(function(c){b.mon(c,"containerclick",b.onEmptyAreaClick,b);b.relayEvents(c,["select","deselect"])})},select:function(e,d,a){e=[].concat(e);var c=false;var b=function(){c=true};this.forEachSelModel(function(g){var f=Ext.Array.filter(e,function(h){return g.store.indexOf(h)>=0});g.on("selectionchange",b,null,{single:true});if(f.length>0){g.select(f,d,a)}else{g.deselectAll()}g.un("selectionchange",b,null,{single:true})});if(c){this.fireEvent("selectionchange",this.getSelection())}},deselect:function(b,a){b=[].concat(b);this.forEachSelModel(function(d){var c=Ext.Array.filter(b,function(e){return d.store.indexOf(e)>=0});d.deselect(c,a)});this.fireEvent("selectionchange",this.getSelection())},selectAll:function(){this.relayMethod("selectAll")},deselectAll:function(){this.relayMethod("deselectAll")},getSelection:function(){return this.relayMethod("getSelection")},getCount:function(){return Ext.Array.sum(this.relayMethod("getCount"))},deselectAllInOtherSelectionModels:function(a){this.forEachSelModel(function(b){b!==a&&b.deselectAll()})},relayMethod:function(b,a){return[].concat.apply([],Ext.Array.map(this.selModels,function(c){return c[b].apply(c,a||[])}))},forEachSelModel:function(b,a){Ext.Array.each(this.selModels,b,a||this)},onEmptyAreaClick:function(){this.deselectAll()},forEachView:function(b,a){Ext.Array.each(this.panel.views,b,a||this)},destroy:function(){}});Ext.define("Kanban.view.TaskView",{extend:"Ext.view.View",alias:"widget.taskview",requires:["Kanban.template.Task","Kanban.data.ViewStore"],autoScroll:true,trackOver:true,overItemCls:"sch-task-over",selectedItemCls:"sch-task-selected",itemSelector:".sch-task",state:null,taskRenderer:function(a,b){},initComponent:function(){this.tpl=new Kanban.template.Task({model:this.store.model,resourceImgTpl:this.resourceImgTpl,taskToolTpl:this.taskToolTpl,taskBodyTpl:this.taskBodyTpl});this.addCls("sch-taskview sch-taskview-state-"+this.state);this.callParent(arguments)},refresh:function(){var b=this.getEl();var a=b.down("."+Ext.baseCSSPrefix+"view-selector");if(a){b.removeChild(a)}this.callParent(arguments);if(a){b.appendChild(a)}},collectData:function(g){var f=this.callParent(arguments),a=[];for(var h=0;h<f.length;h++){var c=Ext.apply({},f[h]);var e=g[h];var d=e.getResource();var b=d&&d.getImageUrl();c.resourceImageCls="";c.resourceImageUrl=b||Ext.BLANK_IMAGE_URL;c.taskImageUrl=e.getImageUrl();c.task=e;c.name=e.getName();if(!b){c.resourceImageCls="sch-no-img"}this.taskRenderer(e,c);if(e.phantom){c.cls=(c.cls||"")+" sch-phantom-task"}a.push(c)}return a}});Ext.define("Kanban.view.TaskColumn",{extend:"Ext.Panel",alias:"widget.taskcolumn",requires:["Ext.layout.container.Fit","Kanban.view.TaskView"],iconCls:"sch-header-icon",flex:1,layout:"fit",collapseDirection:"right",state:null,store:null,taskBodyTpl:null,taskToolTpl:null,resourceImgTpl:null,origTitle:null,view:null,zoomLevel:"large",viewConfig:null,initComponent:function(){var c=this;if(c.state===null){throw"Must supply state"}var b=Ext.apply({store:c.store,state:c.state},c.viewConfig||{});if(c.taskBodyTpl){b.taskBodyTpl=c.taskBodyTpl}if(c.taskToolTpl){b.taskToolTpl=c.taskToolTpl}if(c.resourceImgTpl){b.resourceImgTpl=c.resourceImgTpl}c.items=c.view=new Kanban.view.TaskView(b);var a=Sch.locale.Active["Kanban.locale"]||{};c.origTitle=c.title=(c.title||a[c.state]||c.state);c.callParent(arguments);c.addCls("sch-taskcolumn sch-taskcolumn-state-"+c.state.replace(/\s/g,"-"))},onRender:function(){this.setZoomLevel(this.zoomLevel);if(this.header){this.header.addCls("sch-taskcolumnheader-state-"+this.state.replace(/\s/g,"-"))}this.callParent(arguments)},afterRender:function(){this.callParent(arguments);this.refreshTitle()},refreshTitle:function(){var a=this.state;var b=this.store.query(this.store.getModel().prototype.stateField,a,false,false,true).length;this.setTitle(this.origTitle+(b?" ("+b+")":""))},bindStore:function(a){var b={load:this.refreshTitle,datachanged:this.refreshTitle,update:this.refreshTitle,add:this.refreshTitle,remove:this.refreshTitle,buffer:20,scope:this};if(this.store){this.mun(this.store,b)}if(a){this.mon(a,b);this.view.bindStore(a)}this.store=a},getZoomLevel:function(){return this.zoomLevel},setZoomLevel:function(a){this.zoomLevel=a||"large";this.el.set({size:a})}});Ext.define("Kanban.view.TaskBoard",{extend:"Ext.Panel",alias:"widget.taskboard",requires:["Kanban.locale.Ko","Kanban.data.TaskStore","Kanban.data.ResourceStore","Kanban.view.TaskColumn","Kanban.dd.DropZone","Kanban.dd.DragZone","Kanban.editor.SimpleEditor","Kanban.field.AddNew","Kanban.menu.UserMenu","Kanban.menu.TaskMenu","Kanban.selection.TaskModel"],border:false,layout:{type:"hbox",align:"stretch"},defaultType:"taskcolumn",taskStore:null,resourceStore:null,columnClass:"Kanban.view.TaskColumn",columns:null,columnConfigs:null,editor:null,viewConfig:null,enableUserMenu:true,readOnly:false,userMenu:null,taskMenu:true,dndValidatorFn:Ext.emptyFn,validatorFnScope:null,zoomLevel:"large",taskCls:"sch-task",taskSelector:".sch-task",isHighlighting:false,views:null,kanbanColumns:null,selModel:null,initComponent:function(){var a=this;a.defaults=a.defaults||{};Ext.applyIf(a.defaults,{margin:12});this.taskStore=Ext.data.StoreManager.lookup(this.taskStore);this.resourceStore=Ext.data.StoreManager.lookup(this.resourceStore);this.addCls("sch-taskboard");this.addBodyCls("sch-taskboard-body");this.on({add:this.onColumnsAdded,remove:this.onColumnsRemoved,scope:this});if(!this.columns){this.columns=this.createColumns()}else{this.initColumns(this.columns)}this.items=this.columns;if(!this.taskStore){throw"Must define a taskStore for the Panel"}if(!this.resourceStore){throw"Must define a resourceStore for the Panel"}this.callParent(arguments);this.bindResourceStore(this.resourceStore,true)},createColumns:function(){var c=this;var a=c.taskStore.model.prototype.states;var b=c.columnConfigs||{};return Ext.Array.map(a,function(e,d){return Ext.create(c.columnClass,Ext.apply({store:c.taskStore,state:e,viewConfig:c.viewConfig,zoomLevel:c.zoomLevel,taskBoard:c},Ext.apply(b[e]||{},b.all)))})},initColumns:function(a){var b=this;Ext.Array.forEach(a,function(c){if(c.items){b.initColumns(c.items)}else{Ext.applyIf(c,{store:b.taskStore,viewConfig:b.viewConfig})}},this)},onColumnsAdded:function(c,a){var b=a instanceof Kanban.view.TaskColumn?[a]:a.query("taskcolumn");Ext.Array.forEach(b,function(d){d.bindStore(new Kanban.data.ViewStore({masterStore:this.taskStore,state:d.state}));this.bindViewListeners(d.view);this.kanbanColumns&&this.kanbanColumns.push(d);this.views&&this.views.push(d.view)},this)},onColumnsRemoved:function(c,a){var b=a instanceof Kanban.view.TaskColumn&&a;Ext.Array.remove(this.kanbanColumns,b);Ext.Array.remove(this.views,b.view)},afterRender:function(){var a=this;this.callParent(arguments);if(!this.isReadOnly()){this.setupDragDrop();this.initEditor();this.initTaskMenu();if(this.enableUserMenu&&this.userMenu){this.initUserMenu()}}this.views=this.query("taskview");this.kanbanColumns=this.query("taskcolumn");this.on("taskclick",this.onTaskClick,this)},setReadOnly:function(a){this.readOnly=a},isReadOnly:function(){return this.readOnly},bindViewListeners:function(a){a.on({itemclick:this.getTaskListener("taskclick"),itemcontextmenu:this.getTaskListener("taskcontextmenu"),itemdblclick:this.getTaskListener("taskdblclick"),itemmouseenter:this.getTaskListener("taskmouseenter"),itemmouseleave:this.getTaskListener("taskmouseleave"),itemkeydown:this.getTaskListener("taskkeydown"),itemkeyup:this.getTaskListener("taskkeyup"),scope:this})},setupDragDrop:function(){var a=this;this.dragZone=new Kanban.dd.DragZone(this.id,{panel:this});this.dropZone=new Kanban.dd.DropZone(this.id,{panel:this,validatorFn:this.dndValidatorFn,validatorFnScope:this.validatorFnScope});this.relayEvents(this.dragZone,["beforetaskdrag","taskdragstart","aftertaskdrop"]);this.relayEvents(this.dropZone,["beforetaskdropfinalize","taskdrop","aftertaskdrop"]);this.dropZone.on("aftertaskdrop",this.onAfterTaskDrop,this);this.dragZone.on("taskdragstarting",this.onDragStarting,this)},resolveState:function(b){if(Ext.isIE&&!b){b=document.body}if(!b.dom){var a=Ext.fly(b);if(!a.is(".sch-taskview")){a=a.up(".sch-taskview")}if(a&&a.component){return a.component.state}}return false},setZoomLevel:function(a){this.translateToColumns("setZoomLevel",[a])},getZoomLevel:function(){return this.down("taskcolumn").getZoomLevel()},initEditor:function(){if(this.editor){if(!this.editor.isComponent){this.editor=Ext.widget(this.editor)}this.editor.init(this)}},initUserMenu:function(){if(!(this.userMenu instanceof Ext.Component)){this.userMenu=Ext.ComponentManager.create(this.userMenu)}this.el.on({click:this.onUserImgClick,delegate:".sch-user-avatar",scope:this})},initTaskMenu:function(){if(this.taskMenu){var a=typeof this.taskMenu==="boolean"?{xtype:"kanban_taskmenu"}:this.taskMenu;if(Ext.isArray(a)){a={items:a}}a.taskBoard=this;if(!a.isTaskMenu){this.taskMenu=Ext.widget(Ext.applyIf(a,{xtype:"kanban_taskmenu"}))}this.taskMenu.registerListeners();this.addCls("sch-taskboard-with-menu")}},onUserImgClick:function(b,a){b.stopEvent();if(!this.isReadOnly()){this.userMenu.showForTask(this.resolveRecordByNode(a),b.getXY())}},resolveViewByNode:function(b){var a=Ext.fly(b).up(".sch-taskview");return(a&&Ext.getCmp(a.id))||null},resolveRecordByNode:function(b){var a=this.resolveViewByNode(b);return(a&&a.getRecord(a.findItemByChild(b)))||null},onTaskClick:function(b,a,d,c){if(!c.ctrlKey){this.deselectAllInOtherViews(b)}},deselectAllInOtherViews:function(a){this.getSelectionModel().deselectAllInOtherSelectionModels(a.getSelectionModel())},getElementForTask:function(a){if(!(a instanceof Ext.data.Model)){a=this.taskStore.getById(a)}var b=a.getState();if(b){return Ext.get(this.getViewForState(b).getNode(a))}},getViewForState:function(a){return this.down("taskview[state="+[a]+"]")},forEachColumn:function(b,a){Ext.Array.each(this.query("taskcolumn"),b,a||this)},translateToViews:function(b,a){Ext.Array.map(this.views,function(c){return c[b].apply(c,a||[])})},translateToColumns:function(b,a){Ext.Array.map(this.kanbanColumns,function(c){return c[b].apply(c,a||[])})},translateToSelectionModels:function(b,a){Ext.Array.map(this.views,function(c){var d=c.getSelectionModel();d[b].apply(d,a||[])})},getSelectedRecords:function(){return[].concat.apply([],Ext.Array.map(this.views,function(a){return a.getSelectionModel().getSelection()}))},selectAll:function(){this.getSelectionModel().selectAll()},deselectAll:function(){this.getSelectionModel().deselectAll()},onDestroy:function(){Ext.destroy(this.dragZone,this.dropZone,this.userMenu,this.taskMenu)},getTaskListener:function(a){return function(c,b,f,d,e){this.fireEvent(a,c,b,f,e)}},highlightTasksBy:function(f,d){if(!this.isHighlighting){this.el.addCls("sch-taskboard-filtered");this.isHighlighting=true}this.el.select(".sch-filter-match").removeCls("sch-filter-match");for(var b=0,a=this.taskStore.getCount();b<a;b++){var e=this.taskStore.getAt(b);if(f.call(d||this,e)){var c=this.getElementForTask(e);if(c){c.addCls("sch-filter-match")}}}},clearHighlight:function(){this.isHighlighting=false;this.el.removeCls("sch-taskboard-filtered");this.el.select(".sch-filter-match").removeCls("sch-filter-match")},refresh:function(){this.translateToViews("refresh");this.fireEvent("refresh",this)},refreshTaskNode:function(b){var c=this.getElementForTask(b);if(c){var a=this.resolveViewByNode(c);a.refreshNode(b)}},bindResourceStore:function(a,c){var b={update:this.onResourceStoreUpdate,refresh:this.onResourceStoreRefresh,remove:this.onResourceStoreRemove,scope:this};if(this.resourceStore){this.mun(this.resourceStore,b)}if(a){a=Ext.data.StoreManager.lookup(a);this.mon(a,b);this.taskStore.setResourceStore(a);if(!c){this.refresh()}}this.resourceStore=a},onResourceStoreUpdate:function(){this.refresh()},onResourceStoreRefresh:function(){this.refresh()},onResourceStoreRemove:function(){this.refresh()},onDragStarting:function(a,b,c){if(!c.ctrlKey){this.deselectAllInOtherViews(this.getViewForState(b.getState()))}},onAfterTaskDrop:function(){this.getSelectionModel().deselectAll()},getTaskMenu:function(){return this.taskMenu},getTaskStore:function(){return this.taskStore},getResourceStore:function(){return this.resourceStore},getTaskEditor:function(){return this.editor},getSelectionModel:function(){if(!this.selModel){this.selModel=this.createSelectionModel()}return this.selModel},createSelectionModel:function(){var a=new Kanban.selection.TaskModel({panel:this});this.relayEvents(a,["deselect","select"]);return a}},function(){Ext.apply(Kanban,{VERSION:"2.0.9"})});